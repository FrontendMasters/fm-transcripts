WEBVTT

1
00:00:00.240 --> 00:00:02.040
&gt;&gt; Josh Long: So
we need to propagate our history.

2
00:00:02.040 --> 00:00:07.440
We need to present to it the transcript
of our chat log on each request.

3
00:00:07.440 --> 00:00:10.512
Otherwise it's going to completely
forget what we're talking about and

4
00:00:10.512 --> 00:00:11.760
why we're talking about it.

5
00:00:11.760 --> 00:00:12.520
It has no idea.

6
00:00:12.520 --> 00:00:18.234
Okay, so the way we do that is by advising
this request with an advisor, okay?

7
00:00:18.234 --> 00:00:24.000
So I'm gonna use a prompt
chat memory advisor, okay?

8
00:00:24.000 --> 00:00:30.459
Okay, and
I'll say memory=newConcurrentMap,

9
00:00:30.459 --> 00:00:34.220
oops, ConcurrentHashMap.

10
00:00:35.740 --> 00:00:40.180
Okay, so it's going to be a map of
username to prompt chat memory advisor.

11
00:00:40.180 --> 00:00:44.060
Each user will get their own advisor,
okay, it's multi tenant.

12
00:00:44.060 --> 00:00:45.860
And so how would that work?

13
00:00:45.860 --> 00:00:47.220
I'll say advisor.

14
00:00:47.220 --> 00:00:53.110
Sorry, advisor and I'm going to look
up the current advisor from the map.

15
00:00:53.110 --> 00:00:55.470
So this is a nice idiom here.

16
00:00:55.470 --> 00:00:57.906
If you haven't seen this in Java,

17
00:00:57.906 --> 00:01:03.200
I'm going to say this.memory.compute
if absent passing in the username

18
00:01:03.200 --> 00:01:07.750
which is going to come in the path
variable there, string user.

19
00:01:08.870 --> 00:01:10.950
So if it's there, return it.

20
00:01:10.950 --> 00:01:13.070
If it's not, then create it.

21
00:01:13.070 --> 00:01:14.710
And I'll just create it
brand new like that.

22
00:01:14.710 --> 00:01:17.590
I'm going to use a new
in memory chat memory.

23
00:01:17.590 --> 00:01:20.750
Okay, so I'll say advisor.

24
00:01:20.750 --> 00:01:21.470
Voila.

25
00:01:22.510 --> 00:01:28.190
That actually returns the user's
memory I'm using in memory here.

26
00:01:28.190 --> 00:01:29.790
There's a JDBC one as well.

27
00:01:30.910 --> 00:01:32.590
Let me see what the contract is.

28
00:01:33.630 --> 00:01:37.510
Chat memory, I guess you have to add
the extra jar in the class path.

29
00:01:37.510 --> 00:01:39.310
But there's a chat memory
you can use as well.

30
00:01:40.510 --> 00:01:43.186
You can persist the state in
a SQL database, for example, and

31
00:01:43.186 --> 00:01:45.245
you can also implement
the contract yourself,

32
00:01:45.245 --> 00:01:48.140
you can see chat memory is
a pretty straightforward.

33
00:01:48.140 --> 00:01:49.900
We just have to implement
these three methods.

34
00:01:49.900 --> 00:01:54.060
Void, add, list of messages,
get a list of messages and clear.

35
00:01:54.060 --> 00:01:55.260
That's it.

36
00:01:55.260 --> 00:01:58.311
If you can implement that in terms
of MongoDB or DynamoDB or whatever,

37
00:01:58.311 --> 00:02:00.300
then you can use that instead of this.

38
00:02:00.300 --> 00:02:01.900
Okay, so I've got that.

39
00:02:01.900 --> 00:02:05.020
Now let's just restart this thing,
go back to the console here.

40
00:02:06.540 --> 00:02:07.580
My name is Josh.

41
00:02:09.020 --> 00:02:09.980
Great.

42
00:02:09.980 --> 00:02:11.429
What's my name?

43
00:02:11.429 --> 00:02:12.229
Your name is Josh.

44
00:02:12.229 --> 00:02:16.269
Hey, nice, I knew we were meant to be,
right, this model and me.

45
00:02:16.269 --> 00:02:17.829
Okay, so that's clearly working good.

46
00:02:19.109 --> 00:02:20.749
But still it's not.

47
00:02:20.749 --> 00:02:22.829
I mean I can ask it anything, right?

48
00:02:22.829 --> 00:02:24.629
I can ask it like to do math homework for
me, right?

49
00:02:24.629 --> 00:02:26.469
This is not its stated purpose.

50
00:02:26.469 --> 00:02:29.149
I don't want somebody just
using this endpoint as a.

51
00:02:29.149 --> 00:02:33.349
And letting me ring up my
chatgpt AI OpenAI Bill Right.

52
00:02:33.349 --> 00:02:39.870
I want this to be a focused, purpose built
agent of adoption for my dogs, right?

53
00:02:39.870 --> 00:02:41.190
There's dogs that need to be adopted.

54
00:02:41.190 --> 00:02:43.640
This thing can't be busy doing
people's math homework or

55
00:02:43.640 --> 00:02:45.190
getting them to write code, right?

56
00:02:45.190 --> 00:02:46.990
Did you see, like there's some.

57
00:02:46.990 --> 00:02:50.653
A little while ago, you know, Amazon has
this assistant inside the Amazon Amazon

58
00:02:50.653 --> 00:02:54.314
app or whatever, and somebody realized
that if you like, ask it in a certain way,

59
00:02:54.314 --> 00:02:56.990
you can unset the prompt and
get it to write code for you.

60
00:02:56.990 --> 00:02:59.710
It's supposed to be helping you
find products on the marketplace.

61
00:02:59.710 --> 00:03:01.790
You know, like, we don't want that, right?

62
00:03:01.790 --> 00:03:04.990
So what we wanted, and I'm sure they
did what I'm about to show you, but

63
00:03:04.990 --> 00:03:07.100
it's just funny that that's a thing,
right?

64
00:03:08.460 --> 00:03:13.260
What we want to do is give our
model an overall system prompt.

65
00:03:13.260 --> 00:03:16.220
A system prompt informs
the overall tone and tenor.

66
00:03:16.220 --> 00:03:19.703
It informs what we're expecting
it to do in the in frames,

67
00:03:19.703 --> 00:03:22.416
the thing we're expecting it to do, right?

68
00:03:22.416 --> 00:03:26.300
So that it gives us a response
in terms of that system prompt.

69
00:03:26.300 --> 00:03:29.910
So I happen to have a system
prompt over here, okay.

70
00:03:29.910 --> 00:03:35.510
And I'm gonna cut it and then copy it
to the clip, I'm sorry, you know what?

71
00:03:35.510 --> 00:03:38.492
That's wrong, dog, better.

72
00:03:38.492 --> 00:03:42.597
Okay, I'm gonna dog it to
the clipboard there and

73
00:03:42.597 --> 00:03:47.499
paste it into my system prompt,
okay, var system, okay?

74
00:03:47.499 --> 00:03:49.950
And out here I can configure,
you can do this anywhere.

75
00:03:49.950 --> 00:03:53.070
Actually, I could have done
the system prompt actually here.

76
00:03:53.070 --> 00:03:53.590
Why not?

77
00:03:53.590 --> 00:03:55.320
Let's do it there.

78
00:03:55.320 --> 00:03:56.600
I could do the system prompt here.

79
00:03:58.280 --> 00:04:01.560
So right after the user or
right before the user, it doesn't matter.

80
00:04:01.560 --> 00:04:02.528
Put it there.
If you want,

81
00:04:02.528 --> 00:04:04.840
I'm going to specify a system prompt.

82
00:04:04.840 --> 00:04:08.275
Or you can specify a default system prompt
that is available to all people who

83
00:04:08.275 --> 00:04:09.200
have a chat client.

84
00:04:09.200 --> 00:04:09.920
You can make this a bean.

85
00:04:09.920 --> 00:04:13.200
By the way, like I said, it's not
uncommon to have different models.

86
00:04:13.200 --> 00:04:17.254
So you can have five different chat
clients, one chat client that's talking to

87
00:04:17.254 --> 00:04:21.450
the really fast model, one that's talking
to the more fully featured one, etc.

88
00:04:21.450 --> 00:04:22.050
Okay.

89
00:04:22.050 --> 00:04:24.850
And so you can have bean definitions
that are just chat clients.

90
00:04:24.850 --> 00:04:26.370
Okay.

91
00:04:26.370 --> 00:04:27.770
So there's my system prompt.

92
00:04:27.770 --> 00:04:32.583
It says you are an AI powered assistant
to help people adopt a dog from

93
00:04:32.583 --> 00:04:38.164
the adoption agency named Pooch palace,
with locations in Antwerp, Seoul.

94
00:04:38.164 --> 00:04:40.930
I'm sorry, there you go.

95
00:04:40.930 --> 00:04:43.962
Minneapolis, Seoul, Singapore,
Paris, Mumbai, New Delhi,

96
00:04:43.962 --> 00:04:45.810
Barcelona, San Francisco and London.

97
00:04:45.810 --> 00:04:48.470
Information about the dogs
available will be presented below.

98
00:04:48.470 --> 00:04:49.623
If there's no information,

99
00:04:49.623 --> 00:04:52.630
then return a polite response suggesting
we don't have any dogs available.

100
00:04:52.630 --> 00:04:53.590
Yeah, so let's try.

101
00:04:55.110 --> 00:04:56.590
We're going to ask it to find Prancer.

102
00:04:56.590 --> 00:04:57.590
Remember, that's our dog.

103
00:04:57.590 --> 00:05:03.918
So do you have any

104
00:05:03.918 --> 00:05:10.252
neurotic dogs?

105
00:05:10.252 --> 00:05:11.782
Look, so it says, I'm sorry,

106
00:05:11.782 --> 00:05:15.920
I don't have specific information about
neurotic dogs available at Pooch Palace.

107
00:05:15.920 --> 00:05:18.833
If you're looking for a particular
type of dog or have other preferences,

108
00:05:18.833 --> 00:05:21.416
please let me know and
I'll do my best to assist you.

109
00:05:21.416 --> 00:05:24.080
Okay, well,
at least it's talking about Pooch Palace.

110
00:05:24.080 --> 00:05:28.206
It's acting like it's an employee, you
know, an assistant, somebody who can help

111
00:05:28.206 --> 00:05:31.320
you at our fictitious dog adoption
agency called Pooch Palace.

112
00:05:31.320 --> 00:05:35.458
But it still doesn't know about our dogs,
you might be forgiven for

113
00:05:35.458 --> 00:05:40.033
thinking that you're talking to a real
person who, for whatever reason,

114
00:05:40.033 --> 00:05:44.118
is unable to bring up the inventory
of dogs in the shelter, right?

115
00:05:44.118 --> 00:05:48.440
So what we want to do is to
give it access to that data.

116
00:05:48.440 --> 00:05:49.360
Where does that data live?

117
00:05:49.360 --> 00:05:51.160
It lives in our database, right?

118
00:05:51.160 --> 00:05:53.320
So I don't want to give it
access to all the data.

119
00:05:53.320 --> 00:05:54.400
I mean, let's be clear, right?

120
00:05:54.400 --> 00:05:56.704
Like in this case,
it's a little bit of a silly thing, but

121
00:05:56.704 --> 00:05:58.079
I'm standing on principle here.

122
00:05:58.079 --> 00:06:04.600
So if I click on this hit, okay,
go there, that, that, that.

123
00:06:04.600 --> 00:06:05.160
Okay.

124
00:06:05.160 --> 00:06:06.800
It's only 18 records, okay?

125
00:06:06.800 --> 00:06:11.648
I mean, with the models that we
have today, like you saw Gemini,

126
00:06:11.648 --> 00:06:16.690
Google's Gemini model,
it supports a 2 million context window.

127
00:06:16.690 --> 00:06:21.041
So when I talk about a context,
when I talk about that size, what that is,

128
00:06:21.041 --> 00:06:25.050
is it's a measure of the complexity
of the request or the response.

129
00:06:25.050 --> 00:06:27.010
It's both of them combined, right.

130
00:06:27.010 --> 00:06:29.570
Of the interaction with a model.

131
00:06:29.570 --> 00:06:32.386
Okay.
It's called a context, and

132
00:06:32.386 --> 00:06:34.350
there are tokens.

133
00:06:34.350 --> 00:06:37.070
There's a token count that you
spend each time you make a request.

134
00:06:37.070 --> 00:06:40.412
So the complexity of the request can
stem not just from the input, but

135
00:06:40.412 --> 00:06:42.190
also from their output.

136
00:06:42.190 --> 00:06:46.590
You could say, write the first 500
pages of War and Peace, right?

137
00:06:46.590 --> 00:06:51.230
It's only a one sentence request, but
the response is going to be enormous.

138
00:06:51.230 --> 00:06:56.494
Or I could give it the text of War and
Peace and

139
00:06:56.494 --> 00:07:00.915
say, find the uses of the word lake.

140
00:07:00.915 --> 00:07:04.520
I could give it a large body of requests
and it'll give me one number back.

141
00:07:04.520 --> 00:07:07.874
Find the frequency, right,
it doesn't matter, they both count towards

142
00:07:07.874 --> 00:07:10.920
the complexity of the request,
the token count of the request.

143
00:07:10.920 --> 00:07:13.600
So it's our job to
reduce that token count.

144
00:07:13.600 --> 00:07:18.560
If you're using an on device model
like Ollama, that's free, Right.

145
00:07:18.560 --> 00:07:19.920
You can run that in your local machine.

146
00:07:19.920 --> 00:07:21.800
You don't have to pay anybody.

147
00:07:21.800 --> 00:07:24.833
But even running on your local machine or
in your own data center,

148
00:07:24.833 --> 00:07:27.425
even though you're not paying
somebody to host it, and

149
00:07:27.425 --> 00:07:31.067
even though it's more secure, maybe for
your financial services use cases,

150
00:07:31.067 --> 00:07:34.680
you still have to pay to buy the machines
and pay the electricity and all that.

151
00:07:34.680 --> 00:07:35.720
There's a cost to it.

152
00:07:35.720 --> 00:07:39.555
So you're very strongly incentivized to
reduce that cost by reducing the amount of

153
00:07:39.555 --> 00:07:40.520
tokens consumed.

154
00:07:40.520 --> 00:07:46.280
So, yes, Could I send all the data in
my piddly little 18 row database here?

155
00:07:46.280 --> 00:07:47.960
Sure, but should I?

156
00:07:47.960 --> 00:07:49.675
No, of course not, right?

157
00:07:49.675 --> 00:07:52.360
We wanna send only the results that
are germane to the request at hand.

