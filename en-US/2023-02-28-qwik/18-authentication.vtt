WEBVTT

1
00:00:00.806 --> 00:00:06.774
We should probably add a back button here,
so let's just fix that quickly.

2
00:00:06.774 --> 00:00:09.037
Because I keep wanting to click it,
and I can't.

3
00:00:27.659 --> 00:00:29.217
What's going on here?

4
00:00:29.217 --> 00:00:31.347
We have JavaScript?

5
00:00:31.347 --> 00:00:32.442
It's disabled.

6
00:00:32.442 --> 00:00:35.092
No, what did I do?

7
00:00:35.092 --> 00:00:36.593
It's the wrong one, it's the form.

8
00:00:53.779 --> 00:00:56.208
Okay, edit.

9
00:00:58.859 --> 00:01:04.822
Okay, well, whatever,
back button has unnecessary brackets here.

10
00:01:07.059 --> 00:01:08.735
Okay.

11
00:01:10.829 --> 00:01:15.884
So let's say we wanted to have
this behind a login screen, right?

12
00:01:15.884 --> 00:01:17.723
So how would you do that?

13
00:01:17.723 --> 00:01:22.260
So a typical login is done
through cookies, right?

14
00:01:22.260 --> 00:01:25.552
So let's make a new route
called contacts/login.

15
00:01:31.222 --> 00:01:34.240
Let's go to routes.

16
00:01:34.240 --> 00:01:39.364
Index, sorry, login/index.tsx.

17
00:01:44.153 --> 00:01:49.125
And in here, export

18
00:01:49.125 --> 00:01:54.391
default component.

19
00:02:03.229 --> 00:02:04.479
I can type, I promise.

20
00:02:09.083 --> 00:02:10.090
Okay.

21
00:02:16.129 --> 00:02:19.872
Okay, so, we have our todo.

22
00:02:19.872 --> 00:02:24.631
And, actually,
I'm gonna change this to index!,

23
00:02:27.089 --> 00:02:30.383
So that I don't get any of
the chrome of the page, right?

24
00:02:30.383 --> 00:02:33.993
[COUGH] And this will be pretty simple,
it's just gonna be a form, right?

25
00:02:38.492 --> 00:02:39.795
And the form is,

26
00:02:52.757 --> 00:02:54.472
And this needs to do a post.

27
00:02:58.089 --> 00:03:04.995
Okay, so we're gonna need onGet, [COUGH]

28
00:03:15.147 --> 00:03:21.552
Request, What was the method called?

29
00:03:21.552 --> 00:03:23.893
Now, I can't remember, RequestHandler.

30
00:04:00.608 --> 00:04:06.668
Const endpoint, wow,
look at that, so good.

31
00:04:06.668 --> 00:04:11.988
endpoint, so now we have to have

32
00:04:11.988 --> 00:04:16.530
Resource value endpoint.

33
00:04:22.577 --> 00:04:30.565
OnResolved, Resolved,

34
00:04:33.460 --> 00:04:34.758
Say it again.

35
00:04:34.758 --> 00:04:41.925
&gt;&gt; Value endepoint,
as opposed to endpoint, line 15.

36
00:04:41.925 --> 00:04:44.807
&gt;&gt; Resource value, and there it is.

37
00:04:44.807 --> 00:04:46.015
&gt;&gt; Okay.

38
00:04:57.095 --> 00:05:01.373
Login is unknown,
why is it unknown, endpoint,

39
00:05:01.373 --> 00:05:06.592
because I have to import this,
so that's happy, that's happy.

40
00:05:06.592 --> 00:05:08.062
What am I doing here?

41
00:05:10.606 --> 00:05:16.877
This goes with this guy.

42
00:05:16.877 --> 00:05:19.149
So that goes here.

43
00:05:19.149 --> 00:05:20.617
Here we go, all right.

44
00:05:26.153 --> 00:05:33.640
So the onGet just returns no username,
no password, and no error, right?

45
00:05:33.640 --> 00:05:40.236
That's the initial, think so,
now, at this point, yes, let me,

46
00:05:55.039 --> 00:05:58.733
Okay, so now I can type, and of course,

47
00:05:58.733 --> 00:06:03.427
I don't have a onPost handler,
so let's do that.

48
00:06:16.048 --> 00:06:22.395
Wow, this is so good, mind blown,
how in the world does that do that?

49
00:06:22.395 --> 00:06:26.185
I have no idea, oops, what just happened?

50
00:06:28.875 --> 00:06:31.981
Okay, seriously, how does it know that?

51
00:06:31.981 --> 00:06:35.188
But let's see, formData, we grabbed
the form data from data username.

52
00:06:35.188 --> 00:06:40.810
Yep, sure, look, guys, it even
generated a fake route for me, that's.

53
00:06:40.810 --> 00:06:44.066
Okay, response.redirect to contacts.

54
00:06:44.066 --> 00:06:45.515
Yep, that sounds right too.

55
00:06:45.515 --> 00:06:47.149
[LAUGH] Otherwise.

56
00:06:47.149 --> 00:06:50.352
&gt;&gt; When you ship Microsoft enough code,
they figure out what you want next.

57
00:06:50.352 --> 00:06:53.994
&gt;&gt; [LAUGH] How?

58
00:06:53.994 --> 00:07:01.512
All right, autopilots, you are, okay, I
believe that's correct, [LAUGH] let's see.

59
00:07:04.276 --> 00:07:09.200
Because I didn't do
the code to say value=,

60
00:07:13.148 --> 00:07:18.727
login.username here to persist that,

61
00:07:18.727 --> 00:07:24.806
and then placeholder should say username.

62
00:07:24.806 --> 00:07:32.844
And here,
placeholder should say user password.

63
00:07:32.844 --> 00:07:34.468
Look at that, that's amazing.

64
00:07:34.468 --> 00:07:36.271
Look at that, it's just crazy.

65
00:07:39.507 --> 00:07:43.304
So if I do admin, look at that,

66
00:07:43.304 --> 00:07:47.258
it redirects, that's crazy.

67
00:07:47.258 --> 00:07:49.600
Okay, I just, sorry,
I can't get over this.

68
00:07:49.600 --> 00:07:51.345
Okay, but this is a lie, right?

69
00:07:51.345 --> 00:07:53.706
We're not actually logged in,
we didn't actually do anything.

70
00:07:53.706 --> 00:07:58.506
So, the first thing we need to do is
basically say, if you navigate to one of

71
00:07:58.506 --> 00:08:03.554
these pages that are protected, you need
to check to see if there's a cookie.

72
00:08:03.554 --> 00:08:07.395
And if there's no cookie,
off the login you go.

73
00:08:07.395 --> 00:08:14.884
So, the easiest way to do that is to
go to the contacts and find the layout.

74
00:08:14.884 --> 00:08:18.525
And in the layout,
we add a onRequest method.

75
00:08:18.525 --> 00:08:24.977
So, export const onRequest,
meaning I don't care, onRequest.

76
00:08:27.254 --> 00:08:31.523
Which means I don't care if it's a get,
post, delete, whatever the verb is,

77
00:08:31.523 --> 00:08:32.752
I wanna know about it.

78
00:08:37.057 --> 00:08:40.615
And so, in this particular case,
we are gonna go cookie.

79
00:08:43.340 --> 00:08:50.969
And we're gonna say, cookie.get.

80
00:08:58.579 --> 00:09:00.415
Can I make up a cookie here?

81
00:09:00.415 --> 00:09:03.344
Now, you'll probably have to have
some code that verifies the cookie.

82
00:09:03.344 --> 00:09:04.525
I am skipping over that, right?

83
00:09:04.525 --> 00:09:06.718
This is kind of, you are wrong.

84
00:09:06.718 --> 00:09:12.715
So I'm just gonna do it very, very simply,
and say, look, if the cookie is empty,

85
00:09:12.715 --> 00:09:18.127
if I don't have the cookie, then I'm
gonna assume that I'm not logged in.

86
00:09:18.127 --> 00:09:19.918
Again, this is not what you
would do in the real world.

87
00:09:19.918 --> 00:09:22.708
In real world, you have to put some
kind of encrypted data in there, and

88
00:09:22.708 --> 00:09:24.252
then decrypt it and see if it's valid.

89
00:09:24.252 --> 00:09:29.759
Or check it against session, or something
more complicated than this, right?

90
00:09:29.759 --> 00:09:35.340
So, if I don't have a cookie, then I need
to redirect, so I will say throw response.

91
00:09:38.566 --> 00:09:46.798
Response, because this
has to be RequestHandler.

92
00:09:46.798 --> 00:09:48.259
Let's just leave it void.

93
00:09:48.259 --> 00:09:55.213
[COUGH] response.redirect.

94
00:09:55.213 --> 00:10:01.183
So I wanna go to the login,
but I wanna say redirect and

95
00:10:01.183 --> 00:10:05.708
response.url, yes, request.url.

96
00:10:05.708 --> 00:10:09.697
Request, request, right?

97
00:10:09.697 --> 00:10:12.218
We wanna take the current URL,
put it in there, so

98
00:10:12.218 --> 00:10:13.970
that we know where to come back to.

99
00:10:19.614 --> 00:10:20.444
I think that's it.

100
00:10:20.444 --> 00:10:23.513
And look at that,
it already redirected us, right?

101
00:10:23.513 --> 00:10:27.951
So we were at /contacts,
we got redirected to login,

102
00:10:27.951 --> 00:10:30.756
so now we need to log ourselves in.

103
00:10:30.756 --> 00:10:33.830
And so, if you go back to the login,

104
00:10:36.337 --> 00:10:40.473
It's not just we redirect
ourselves to contacts,

105
00:10:40.473 --> 00:10:44.519
we should redirect ourselves
to the redirect ID.

106
00:10:44.519 --> 00:10:48.154
But before we can do that,
we need to set a cookie, right?

107
00:10:48.154 --> 00:10:53.420
cookie, cookie.set.

108
00:10:53.420 --> 00:10:54.711
So what was the cookie name?

109
00:11:01.489 --> 00:11:03.881
Okay, again, you wouldn't do true,
cuz that's a horrible cookie.

110
00:11:03.881 --> 00:11:09.498
[LAUGH] Let's see,

111
00:11:09.498 --> 00:11:13.182
I'm sure there's third party libraries
that do this kind of stuff, right?

112
00:11:13.182 --> 00:11:16.058
So it's something that
you wanna do over here.

113
00:11:16.058 --> 00:11:19.986
And so, the thing we want over here,
so actually before I do that,

114
00:11:19.986 --> 00:11:21.824
it stays the same URL, right?

115
00:11:21.824 --> 00:11:29.178
So then we just need to do,
we need to redirect to request.search.

116
00:11:34.653 --> 00:11:37.269
How do we do this?

117
00:11:37.269 --> 00:11:38.576
Right, request.

118
00:11:41.602 --> 00:11:44.923
Request, and then is request,
response, url,

119
00:11:44.923 --> 00:11:48.178
params, platform, okay, so that's the URL.

120
00:11:48.178 --> 00:11:54.550
Okay, so we have to do the URL.

121
00:11:54.550 --> 00:11:55.763
So we get the URL.

122
00:11:58.154 --> 00:12:02.032
And then I believe you have

123
00:12:02.032 --> 00:12:06.971
to say const redirectUrl=new.

124
00:12:06.971 --> 00:12:13.850
Yes, my gosh,
how did you get that, redirectUrl.

125
00:12:13.850 --> 00:12:20.565
So now, if I don't type anything here,
it doesn't work.

126
00:12:20.565 --> 00:12:26.136
But if I do admin,
it should have redirected me.

127
00:12:26.136 --> 00:12:28.875
I think when you're setting a cookie,

128
00:12:28.875 --> 00:12:34.360
I think you have to say which path you
are for, and you wanna say for everybody.

129
00:12:34.360 --> 00:12:35.659
I think that's what the issue is.

130
00:12:39.393 --> 00:12:41.636
Yes, there we go.

131
00:12:41.636 --> 00:12:47.823
So now, we have that bit as well,
and of course, you could add one for

132
00:12:47.823 --> 00:12:52.546
doing a logout,
which just deletes the cookie etc.

133
00:12:52.546 --> 00:12:58.877
So the point of this is that,
where's my layout?

134
00:13:01.896 --> 00:13:06.696
The point of this is that you can guard
everything in a subdirectory with a top

135
00:13:06.696 --> 00:13:11.346
level onRequest, which doesn't care
whether it's an onGet or onPost or

136
00:13:11.346 --> 00:13:13.599
onDelete, and it gets to execute.

137
00:13:13.599 --> 00:13:20.430
And this particular middleware can then
basically says, you're not logged in,

138
00:13:20.430 --> 00:13:26.372
and so just redirect everybody under
this location to a different URL.

