WEBVTT

1
00:00:00.470 --> 00:00:02.620
Now that we've got our development
environment, we've got a mono repo.

2
00:00:02.620 --> 00:00:05.580
Let's dig in and
start just making some stuff.

3
00:00:05.580 --> 00:00:11.020
So the first thing I wanna do is
I want to build a custom page.

4
00:00:11.020 --> 00:00:17.310
And I wanna do this without using files
instead I wanna use the node API's.

5
00:00:17.310 --> 00:00:22.672
So Gatsby has this concept of node
API's where during the build process,

6
00:00:22.672 --> 00:00:26.920
it will expose hooks into
different parts of the process.

7
00:00:26.920 --> 00:00:30.450
So there's a create pages API,
a source nodes API.

8
00:00:30.450 --> 00:00:34.450
We're gonna look into how we can use
those to customize our Gatsby site.

9
00:00:34.450 --> 00:00:37.060
So the first one we're gonna
look at is called create pages.

10
00:00:37.060 --> 00:00:41.932
And the way that this works is we
are going to create a new file at

11
00:00:41.932 --> 00:00:46.245
the root called Gatsby,
node.js and inside of this,

12
00:00:46.245 --> 00:00:50.540
we can export any number
of hooks that we want to.

13
00:00:50.540 --> 00:00:55.160
And so the one that we're actually
looking at first is create pages, so

14
00:00:55.160 --> 00:00:56.970
exports create pages.

15
00:00:56.970 --> 00:01:00.794
Now remember this is node,
so it needs to be done,

16
00:01:00.794 --> 00:01:04.540
let me turn off copilot,
so it doesn't, yeah.

17
00:01:04.540 --> 00:01:09.636
Copilot gets really confusing
if I'm trying to do one thing,

18
00:01:09.636 --> 00:01:16.011
and it's helping, so in here, we've
got the ability to export a function.

19
00:01:16.011 --> 00:01:20.526
And whatever we do in this function will
get run as part of the create pages step

20
00:01:20.526 --> 00:01:22.740
of the Gatsby build process.

21
00:01:22.740 --> 00:01:26.366
And for us,
we just wanna create our first page,

22
00:01:26.366 --> 00:01:30.800
so let's pull out of the actions,
the create page action.

23
00:01:33.170 --> 00:01:37.530
And this is an object that gets
passed in with various helpers.

24
00:01:37.530 --> 00:01:40.830
We'll, use a handful of
these throughout the day.

25
00:01:40.830 --> 00:01:45.014
I'll go into what the ones we use are,
but know that's not an exhaustive list,

26
00:01:45.014 --> 00:01:48.100
there's more stuff you can
do with the Gatsby APIs.

27
00:01:48.100 --> 00:01:54.250
I'm gonna do the ones that
are most practically useful.

28
00:01:54.250 --> 00:01:58.917
Some of them get a little esoteric like
you can get into changing the Webpack and

29
00:01:58.917 --> 00:02:02.114
double config,
which I would recommend you don't.

30
00:02:02.114 --> 00:02:05.100
[LAUGH] I mean, you can do whatever
you want, but it's it's gonna.

31
00:02:06.210 --> 00:02:08.931
Anytime you get into the internals,
you're probably gonna have a bad time

32
00:02:08.931 --> 00:02:10.800
unless you've got a very good reason for
doing so.

33
00:02:11.800 --> 00:02:16.823
So the way the create page API works
is we're gonna pass it an object,

34
00:02:16.823 --> 00:02:19.780
and create page requires three things.

35
00:02:19.780 --> 00:02:24.922
The first thing is a path, the second
thing is a component, and the third

36
00:02:24.922 --> 00:02:31.010
thing is optional, which is context, so
let's actually leave context out for now.

37
00:02:32.890 --> 00:02:37.950
So a component is gonna actually look for
a file of react component

38
00:02:37.950 --> 00:02:42.650
that we can use to render this page,
so we need to build that.

39
00:02:42.650 --> 00:02:45.438
So before we save this file,
let's actually go in here, and

40
00:02:45.438 --> 00:02:47.090
let's make ourselves a template.

41
00:02:47.090 --> 00:02:50.790
So I'm gonna create a folder called
templates, if I can spell it.

42
00:02:52.670 --> 00:02:55.965
Templates, and
we'll call this one custom.js,

43
00:02:55.965 --> 00:02:59.570
this is gonna be more of
a proof of concept page.

44
00:02:59.570 --> 00:03:02.940
And inside of it, let's make
a pretty standard react component.

45
00:03:02.940 --> 00:03:05.420
We're gonna import everything as react.

46
00:03:05.420 --> 00:03:11.033
From react, this is a workaround for
react 17 not requiring the global

47
00:03:11.033 --> 00:03:16.380
react import anymore, but
Gatsby not having implemented that yet.

48
00:03:16.380 --> 00:03:19.917
So you have to pull in the whole library,
and

49
00:03:19.917 --> 00:03:24.900
then we're going to export
default function, custom page.

50
00:03:26.250 --> 00:03:30.889
And inside of it, we can add some,
let's leave that part out actually,

51
00:03:30.889 --> 00:03:32.879
we'll get to that in a minute.

52
00:03:32.879 --> 00:03:38.103
So let's return just a basic div, and

53
00:03:38.103 --> 00:03:43.006
inside of it we can say custom page.

54
00:03:45.535 --> 00:03:48.020
All right, so now that we've
got that we can load this in.

55
00:03:48.020 --> 00:03:53.090
So we're gonna use require.resolve, which
is a way to get the the absolute path.

56
00:03:53.090 --> 00:03:58.580
To a component and we're gonna use the
templates/custom.js that we just created.

57
00:03:58.580 --> 00:04:00.906
And I'm gonna set this
at a path of custom, so

58
00:04:00.906 --> 00:04:03.990
the path is just whatever we
want it to be on the site.

59
00:04:03.990 --> 00:04:08.350
So /custom will be mysite.com/custom.

60
00:04:08.350 --> 00:04:12.466
And now that I've done that if we stop and
restart,

61
00:04:12.466 --> 00:04:15.450
because we just added a new process.

62
00:04:17.500 --> 00:04:23.413
And we can look at the stages in here
as well as this builds as it starts.

63
00:04:25.650 --> 00:04:29.360
So there's these hooks here on pre-init.

64
00:04:29.360 --> 00:04:32.560
And on pre-bootstrap and
create schema customization.

65
00:04:32.560 --> 00:04:39.420
And there's create pages, so when we ran
create pages Gatsby picked up our changes.

66
00:04:39.420 --> 00:04:44.490
And now, if we go in here and look, we can
go to our custom page, and there it is.

67
00:04:45.560 --> 00:04:47.320
So this is a really powerful workflow,
right?

68
00:04:47.320 --> 00:04:52.217
It lets us do a lot, but it's not
particularly useful right now because you

69
00:04:52.217 --> 00:04:57.194
this way, what's the benefit of doing
this versus just like creating a page

70
00:04:57.194 --> 00:05:01.950
called custom.js, right,
there's no, real benefit here.

71
00:05:01.950 --> 00:05:05.616
So where the create page starts to
become extremely interesting is

72
00:05:05.616 --> 00:05:07.960
when we start including context.

73
00:05:07.960 --> 00:05:11.304
So with context,
we can just pass in any object, and

74
00:05:11.304 --> 00:05:15.990
whatever we pass here is gonna be
made available to our Gatsby site.

75
00:05:15.990 --> 00:05:20.350
So I'm gonna keep this pretty simple,
let's do a custom page.

76
00:05:21.370 --> 00:05:25.460
And then we'll add some meta stuff,
so we'll do a description.

77
00:05:25.460 --> 00:05:28.820
And inside that we can say
a custom page with context.

78
00:05:31.570 --> 00:05:35.080
And that's probably good enough,
right, and

79
00:05:35.080 --> 00:05:39.390
then let's change this out
before we restart that thing.

80
00:05:39.390 --> 00:05:43.762
So anything that we pass in context
is gonna be available in this prop

81
00:05:43.762 --> 00:05:46.680
pass to the page called page context.

82
00:05:46.680 --> 00:05:50.382
And so in here, if we look at it,

83
00:05:50.382 --> 00:05:55.060
we can now use this to just set things up.

84
00:05:55.060 --> 00:05:58.964
So remember, we had that title,
so let's just grab that title and

85
00:05:58.964 --> 00:06:00.490
use it as our page title.

86
00:06:00.490 --> 00:06:02.245
And then for the sake of brevity,

87
00:06:02.245 --> 00:06:05.762
since this is just to demonstrate
the concept before we go deeper.

88
00:06:05.762 --> 00:06:09.751
I'm just gonna dump everything else
in page context into a pretext so

89
00:06:09.751 --> 00:06:14.012
we can see what's in there, so
let's save that, let's come out here and

90
00:06:14.012 --> 00:06:15.829
let's restart that browser.

91
00:06:19.675 --> 00:06:22.535
Looks like it didn't do it, so
I'm gonna stop and restart it manually.

92
00:06:24.295 --> 00:06:28.039
This is one of the things that can get
a little tedious with doing more advanced

93
00:06:28.039 --> 00:06:31.858
Gatsby stuff is when you start messing
with the config files with Gatsby node.

94
00:06:31.858 --> 00:06:35.100
And some of the other ones you'll end up
stopping and restarting the server a lot.

95
00:06:36.410 --> 00:06:41.738
So when you've got good reason to do it,
absolutely, you should do it when

96
00:06:41.738 --> 00:06:46.740
you just don't opt in voluntary
suffering is my least favorite kind.

97
00:06:46.740 --> 00:06:51.625
So do as little as you
have to that's a motto,

98
00:06:51.625 --> 00:06:54.590
let's take a look at this.

99
00:06:54.590 --> 00:06:58.540
So basically what we did here
is we passed in this context.

100
00:06:58.540 --> 00:07:00.454
And everything that we passed in,

101
00:07:00.454 --> 00:07:04.810
this gets passed directly as page context
which we can see looking at the site,

102
00:07:04.810 --> 00:07:08.509
because this is what got dumped
out of that page context variable.

103
00:07:09.590 --> 00:07:12.858
This is a really handy way
to pass in information and

104
00:07:12.858 --> 00:07:17.570
theoretically speaking, you could
build your whole Gatsby site without

105
00:07:17.570 --> 00:07:22.130
ever looking at the GraphQL layer by
just passing in context like this.

106
00:07:22.130 --> 00:07:24.980
You could load things
from a third party API,

107
00:07:24.980 --> 00:07:27.745
drop it into this custom page context.

108
00:07:27.745 --> 00:07:31.849
And then use that to
set up your titles and

109
00:07:31.849 --> 00:07:37.537
your blog role and all that stuff,
it is fairly useful.

110
00:07:37.537 --> 00:07:41.507
But as you get into more and more complex
pages, it can get pretty challenging.

111
00:07:41.507 --> 00:07:44.518
So we'll look at a way to
make this a little bit

112
00:07:44.518 --> 00:07:47.539
better as we get into
some of the custom data.

113
00:07:47.539 --> 00:07:51.056
And see a more useful pattern for
for using context and

114
00:07:51.056 --> 00:07:54.917
how we can kind of level that
up to make things easier.

115
00:07:54.917 --> 00:07:59.681
The other thing that I don't like is
that if we use this approach; Were

116
00:07:59.681 --> 00:08:01.537
all the data is in context,

117
00:08:01.537 --> 00:08:07.080
then I don't actually know what's here
until I go and look at Gatsby node.

118
00:08:07.080 --> 00:08:10.573
So there's a little bit of like hopping
between files to figure out what's

119
00:08:10.573 --> 00:08:12.220
available to me to use it.

120
00:08:12.220 --> 00:08:16.774
And I kind of prefer the the GraphQL way
where the query that shows me what data is

121
00:08:16.774 --> 00:08:19.420
in the file is just right up above.

122
00:08:19.420 --> 00:08:23.470
So this is like baby steps
with create page, but

123
00:08:23.470 --> 00:08:26.620
let's go a little bit further here.

