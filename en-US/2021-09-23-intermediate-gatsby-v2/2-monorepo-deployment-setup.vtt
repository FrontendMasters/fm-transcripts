WEBVTT

1
00:00:00.940 --> 00:00:03.424
Let's get our Monorepo setup.

2
00:00:03.424 --> 00:00:06.710
So the first thing I'm gonna
do is out in the main repo.

3
00:00:06.710 --> 00:00:11.880
And so this is something that's a little
bit different from like a non monorepo.

4
00:00:11.880 --> 00:00:16.710
If you're building in a standard way, you
would put all of this the source folder,

5
00:00:16.710 --> 00:00:20.096
the gatsby config,
the package JSON, right in the root.

6
00:00:20.096 --> 00:00:23.976
But because we're gonna be
working on multiple packages,

7
00:00:23.976 --> 00:00:27.660
one is gonna be the site,
one is gonna be our theme.

8
00:00:27.660 --> 00:00:30.640
We need a way to differentiate
those in our repo.

9
00:00:30.640 --> 00:00:33.100
So I created a folder for the site.

10
00:00:33.100 --> 00:00:37.810
And now we need to tell
yarn that it exists, right?

11
00:00:37.810 --> 00:00:42.767
So we're gonna put another
package.json in the root.

12
00:00:42.767 --> 00:00:47.160
And inside of it, we're gonna tell it Just
the bare minimum that it needs to know.

13
00:00:47.160 --> 00:00:51.575
So we want to make sure that this
doesn't get published to NPM.

14
00:00:51.575 --> 00:00:54.765
That is not what this is for.

15
00:00:54.765 --> 00:00:59.050
Then we're going to say that
we're going to use workspaces.

16
00:00:59.050 --> 00:01:00.919
And the way that workspaces work,

17
00:01:00.919 --> 00:01:05.051
is we give them an array of folder names
that are the workspaces we wanna use.

18
00:01:05.051 --> 00:01:09.234
So I'm going to set site,
which matches this here site.

19
00:01:09.234 --> 00:01:14.530
And that will tell yarn that we
wanna use that particular site.

20
00:01:14.530 --> 00:01:18.570
Then, because I want some shortcuts,
I'm gonna add some scripts.

21
00:01:18.570 --> 00:01:23.166
So my develop is going to run
the site development command.

22
00:01:23.166 --> 00:01:26.780
And the reason I'm adding a shortcut,
it's a little verbose.

23
00:01:26.780 --> 00:01:30.622
So if I run yarn workspace site develop,

24
00:01:30.622 --> 00:01:35.029
that's what will will
cause this site to run,

25
00:01:35.029 --> 00:01:40.795
what you would run with NPM,
run, develop or yarn develop.

26
00:01:40.795 --> 00:01:43.360
Because I don't want to
type that every time now,

27
00:01:43.360 --> 00:01:47.520
I can do yarn develop It will
run yarn workspace site develop.

28
00:01:47.520 --> 00:01:50.230
Same thing with the build command.

29
00:01:50.230 --> 00:01:51.790
I just want to alias that.

30
00:01:51.790 --> 00:01:54.570
So yarn workspace site build.

31
00:01:55.790 --> 00:02:02.000
And that gives us our ability to shorthand
NPM run, develop NPM run, build.

32
00:02:02.000 --> 00:02:04.160
And that's it for this.

33
00:02:04.160 --> 00:02:08.705
So what we can do now is we can
go over to our terminal and

34
00:02:08.705 --> 00:02:11.440
I can install my dependencies.

35
00:02:12.720 --> 00:02:17.410
So we start out by installing
all of our dependencies.

36
00:02:17.410 --> 00:02:21.312
And what's interesting here is,
I ran this in the root.

37
00:02:21.312 --> 00:02:25.568
But because it saw this workspace,
it went into this site and

38
00:02:25.568 --> 00:02:27.910
found its dependencies as well.

39
00:02:28.990 --> 00:02:32.435
And so we can see here that like
all the stuff we need for Gatsby,

40
00:02:32.435 --> 00:02:36.960
is actually up here at the top level
instead of being in the site folder.

41
00:02:36.960 --> 00:02:39.584
And that's really convenient because
that also means when you're working

42
00:02:39.584 --> 00:02:40.242
with workspaces.

43
00:02:40.242 --> 00:02:42.542
If your packages share
the same version of something,

44
00:02:42.542 --> 00:02:44.100
you don't have to install it twice.

45
00:02:44.100 --> 00:02:47.400
You'll just have one node modules folder.

46
00:02:47.400 --> 00:02:49.811
And then it kinda does this alias here so

47
00:02:49.811 --> 00:02:53.770
that we've got access to the Gatsby
command inside of the site.

48
00:02:55.430 --> 00:02:59.967
And then, now that we've got this set up,

49
00:02:59.967 --> 00:03:06.105
we're gonna tell netlify
how to find our monorepo.

50
00:03:06.105 --> 00:03:10.705
So we're gonna create a new file,
called Netlify.toggle.

51
00:03:10.705 --> 00:03:17.785
And in this, we're just gonna tell this
is for the CLI to know where the site is.

52
00:03:17.785 --> 00:03:20.125
So we're going to set base site.

53
00:03:20.125 --> 00:03:22.222
And that's just to say
when you build this,

54
00:03:22.222 --> 00:03:24.170
the site is what we're gonna publish.

55
00:03:24.170 --> 00:03:27.900
The theme is a supporting file that
will actually be installed by the site.

56
00:03:28.940 --> 00:03:32.436
So when we publish this monorepo, the only
thing that we want to build is the site so

57
00:03:32.436 --> 00:03:34.070
we can move netlify into that folder.

58
00:03:35.440 --> 00:03:41.265
And finally, now that we've installed our
dependencies, we can run Netlify dev.

59
00:03:41.265 --> 00:03:46.280
And Netlify dev is a COI command,
that gives us a lot of power.

60
00:03:46.280 --> 00:03:51.580
It auto detects what you're using, so
it can see what framework we're using.

61
00:03:51.580 --> 00:03:52.890
We're using Gatsby.

62
00:03:52.890 --> 00:03:55.540
It runs the develop command for us.

63
00:03:55.540 --> 00:03:59.484
And you can see here, that it's like kind
of doing some environment variables stuff,

64
00:03:59.484 --> 00:04:01.980
that'll become more useful later.

65
00:04:01.980 --> 00:04:03.813
So then it runs our
Gatsby develop command.

66
00:04:06.480 --> 00:04:11.390
And once this is done here, it's actually
gonna pop open a browser for us.

67
00:04:12.880 --> 00:04:14.260
&gt;&gt; And it has modeled out.

68
00:04:14.260 --> 00:04:19.358
So when we were setting up our yarn So,
what it is,

69
00:04:19.358 --> 00:04:26.490
was it detects the package.json
inside the site for a folder, right?

70
00:04:26.490 --> 00:04:29.990
So when we set up
a couple of more folders,

71
00:04:29.990 --> 00:04:35.780
like you said a theme and
maybe we are having a couple of themes.

72
00:04:35.780 --> 00:04:40.847
So will the yarn file detect each and
every pack a package.jsan?

73
00:04:40.847 --> 00:04:44.674
Or recursively through those,
file structure and

74
00:04:44.674 --> 00:04:48.180
install all of the dependencies?

75
00:04:48.180 --> 00:04:49.916
&gt;&gt; No.
So what it will do,

76
00:04:49.916 --> 00:04:53.240
is it will detect the ones
that we've told it to.

77
00:04:53.240 --> 00:04:54.920
So we told it to look at site.

78
00:04:54.920 --> 00:04:58.150
And so, it's gonna look in here,
and actually this is a good point.

79
00:04:58.150 --> 00:05:01.430
It uses the name in here,
which can be kinda confusing.

80
00:05:01.430 --> 00:05:06.446
So when we did yarn workspace
site develop, it's looking for

81
00:05:06.446 --> 00:05:10.630
this package name and
not the name of the folder.

82
00:05:10.630 --> 00:05:13.030
So that can be a little bit confusing.

83
00:05:13.030 --> 00:05:15.392
So if this folder was called like,
website, but

84
00:05:15.392 --> 00:05:17.187
the package in here was called site.

85
00:05:17.187 --> 00:05:19.230
You would put website as the workspace but

86
00:05:19.230 --> 00:05:21.691
you would still run yarn
workspace site develop.

87
00:05:21.691 --> 00:05:25.609
So that's why I always named the folders
the same thing because otherwise I get

88
00:05:25.609 --> 00:05:28.370
really confused and it has a hard time.

89
00:05:28.370 --> 00:05:32.267
If you want it to auto detect
a whole group of things,

90
00:05:32.267 --> 00:05:36.790
you can do I think it's either a star or
double star.

91
00:05:36.790 --> 00:05:40.300
We're not gonna use that today,
but I have used it in the past.

92
00:05:40.300 --> 00:05:45.291
It's documented well on the yarn
workspaces, docks if you wanna do that.

93
00:05:45.291 --> 00:05:50.310
But that will auto detect
the packages inside of that folder.

94
00:05:50.310 --> 00:05:53.623
So that can be really nice if you're
working on a mono repo that's

95
00:05:53.623 --> 00:05:57.188
got like all of your open source node
packages or something like that.

96
00:05:57.188 --> 00:06:00.200
Where you don't want to have to
explicitly declare each one.

97
00:06:03.050 --> 00:06:07.327
Okay, so we're up and running,
we've got the site is is functioning.

98
00:06:07.327 --> 00:06:11.730
Now a slight difference Gatsby goes
to 8000, Netlify dev goes to 8888.

99
00:06:11.730 --> 00:06:14.143
That's because it is running
Gatsby at Port 1000 and

100
00:06:14.143 --> 00:06:16.880
then proxying it along with
the serverless functions.

101
00:06:16.880 --> 00:06:20.261
So that way we were able to go in.

102
00:06:20.261 --> 00:06:22.300
Otherwise everything is exactly the same.

103
00:06:22.300 --> 00:06:28.550
If we come in here and make a change,
then it's auto updated.

104
00:06:28.550 --> 00:06:30.470
Everything happens very quickly.

105
00:06:30.470 --> 00:06:32.691
So great we have
a development environment.

106
00:06:32.691 --> 00:06:33.930
We're up and running now.

