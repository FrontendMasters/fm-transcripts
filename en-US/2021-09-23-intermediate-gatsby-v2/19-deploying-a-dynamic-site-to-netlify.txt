[00:00:00]
>> Why don't we go ahead and build ourselves a deployable site. So, because this is a mono repo Gatsby sites have by default they're going to build to a folder called public. This is what the build folder looks like. And they've got this dot cache folder which needs to be kept around between sites.

[00:00:20]
And now we told netlify to look in the the netlify dot tommo here, but once it looks in here, it needs to find another. Netlify dot tahmo to tell it what the rules are, I mean, we could go configure this to the UI as well. But if we're sending this to other people, it's just easier to not make them do the configuration manually when we can commit it into the code.

[00:00:45]
So, we want to make sure that it uses the right workspace command. So we're gonna say yarn workspace site build is our command instead of the autodetected Gatsby build that we would get. We're going to set our published directory to public. And because it's in this folder, it's relative, right, so we are you.

[00:01:03]
If we close up source, we're in this directory, and we want to get to public. And then, I also want to make sure, this is a quirk that honestly this is something that I think netlify needs to improve but, right out of the gate, we don't have a lock file in this folder, the lock file is actually outside of it in the top level.

[00:01:26]
So, by default Gatsby won't use yarn. So I'm going to tell it to use yarn by setting an environment variable here. And this is one way that you can set an environment variable, but as you can see, this is a little bit, I don't know this doesn't scale, right like having to having to put a ton of these in.

[00:01:46]
That's not gonna that's not gonna fly forever right? So for one, okay, fine. All good, don't care. But for multiple it's not gonna work very well. The other thing that we're doing is we're using these client only routes where we want these catch alls. And that means that there are redirects being done.

[00:02:05]
And in order to get redirects to get picked up properly, we need to install a plugin that will sync those between Gatsby and whatever host it's using. So for netlify, we will yarn workspace site add, and then we're going to add Gatsby plugin netlify. And this is going to make the redirects work and it adds some other stuff like Content Security Policy headers and iframe security.

[00:02:29]
And some things that will help with your your web speed score. Once we've got that plugin, we can just toss it at the bottom of our Gatsby config. Doesn't need any options or anything. So we'll put in gatsby-plugin-netlify, okay? And then, we can just add all this stuff.

[00:02:53]
So let's add everything. Git commit and say, site ready to deploy. Let's push it Okay. So, what I'm gonna do, is I have to use this progress branch, which means I have to do an extra step because by default, what netlify will do is, is run off the main branch.

[00:03:20]
So I'm gonna do a netlify in it. And actually, I wonder if it'll let me set the branch, that would be cool. Nah, that's okay. So let's do netlifying it, and this is going to walk me through setting up a new site. So I'm gonna create and configure a new site.

[00:03:40]
And then I'm gonna choose my own team. And I want to give this a name. So let's call it front end masters intermediate Gatsby. That's already taken. Let's try another one frontend-masters-intermediate-gatsby-project. There we go. All right. So we already know that we've got the base set to site and because it's reading our netlify.tom, we'll now it can see it wants yarn workspace I build, good.

[00:04:13]
It's pulling public, right? We can ignore that one. It needs the essential Gatsby plugin. This is gonna keep the cache around. It's gonna make Gatsby functions work. It does a bunch of stuff like that, theoretically, you could opt out of it, but I don't know why you would.

[00:04:26]
So we will let that run. And then we're off to the races. So let's open this. And what I have to do is because I see it open in the wrong browser, let's pull it on to this one. Because I changed my branch, I'm just gonna jump into the site settings and go to deploy.

[00:04:47]
Let me make this a little bit bigger so it's easier to read and to go to build and deploy. And then I'm going to change the branch. And I'm just going to build this progress branch that we've been using. So let me save that. head out to my deploys.

[00:05:01]
You don't need to finish that one so we can cancel it. And then I'm going to go to here, and let's just start again. So I'm going to deploy the site. All right. So here we go. We're deploying the site, and this is going to install node. It's going to install all of our packages.

[00:05:18]
Yarn, all the things that we need, and then it's going to run our yarn workspaces command. It'll also compile our functions and store the cache and all the stuff that we don't want to have to do ourselves, so that we can just move on with our day and be happy about having deployed a site instead of thinking about how to get that site deployed.

[00:05:47]
This'll take usually about two minutes the first time around, and then it'll drop down to about a minute on repeat deploys. The thing about Gatsby is that it's a really large NPM package. But we don't ship most of that to production, right, Gatsby is a build tool. So it pulls in a ton of stuff for building sites.

[00:06:15]
And then the vast majority of that is only used for the bill, it doesn't actually get used in production on the client site. So there's a, it's important to look at not just the package size because that can be misleading. It's important to look at what actually comes out of the production build.

[00:06:33]
Because a very small package can produce huge bundle sizes. If it's not optimized, and vice versa huge package that's optimized well can can create some pretty tiny bundles. Okay, so we're running the build. You can see it's installing this this plug in. It doesn't have a Gatsby cache because this is the first time we're building the site.

[00:06:56]
It's running that yarn workspace site build. That's what we wanted. So off to the races we go and this will just take a few more seconds. And then once this finishes netlify will bundle the functions, push all these pages up to this and then we will be live.

[00:07:17]
There we go. Functions bundling that's done, it's deploying the site, that goes and we got ourselves a site, so we can go look at this. Now we've got our site, up on the internet, we can go to our books, we can go to our account. And here we go if we log in great, log out great.

[00:07:41]
All the things that we want to do, right? It's all doing what we want. And we've got our optimized images. So, this is pretty slick. It's it's really doing what we can It's doing what we want. I'm you know, I'm happy with this. We're able to get it up pretty quickly.

[00:07:55]
And it's it's fairly painless to get this up and running. And now, any changes that we make also automatically build and deploy

