WEBVTT

1
00:00:00.430 --> 00:00:04.140
Why don't we go ahead and
build ourselves a deployable site.

2
00:00:04.140 --> 00:00:09.254
So, because this is a mono repo
Gatsby sites have by default

3
00:00:09.254 --> 00:00:13.720
they're going to build to
a folder called public.

4
00:00:13.720 --> 00:00:16.110
This is what the build folder looks like.

5
00:00:16.110 --> 00:00:19.504
And they've got this dot cache
folder which needs to be kept around

6
00:00:19.504 --> 00:00:20.430
between sites.

7
00:00:20.430 --> 00:00:25.724
And now we told netlify to look in
the the netlify dot tommo here,

8
00:00:25.724 --> 00:00:30.050
but once it looks in here,
it needs to find another.

9
00:00:31.490 --> 00:00:34.431
Netlify dot tahmo to tell it
what the rules are, I mean,

10
00:00:34.431 --> 00:00:37.440
we could go configure
this to the UI as well.

11
00:00:37.440 --> 00:00:41.527
But if we're sending this to other people,
it's just easier to not make them do

12
00:00:41.527 --> 00:00:45.270
the configuration manually when
we can commit it into the code.

13
00:00:45.270 --> 00:00:48.870
So, we want to make sure that it
uses the right workspace command.

14
00:00:48.870 --> 00:00:52.293
So we're gonna say yarn workspace
site build is our command instead of

15
00:00:52.293 --> 00:00:54.740
the autodetected Gatsby
build that we would get.

16
00:00:54.740 --> 00:00:59.280
We're going to set our
published directory to public.

17
00:00:59.280 --> 00:01:03.390
And because it's in this folder,
it's relative, right, so we are you.

18
00:01:03.390 --> 00:01:07.630
If we close up source, we're in this
directory, and we want to get to public.

19
00:01:08.890 --> 00:01:13.792
And then, I also want to make sure,
this is a quirk that honestly this is

20
00:01:13.792 --> 00:01:17.472
something that I think
netlify needs to improve but,

21
00:01:17.472 --> 00:01:21.884
right out of the gate,
we don't have a lock file in this folder,

22
00:01:21.884 --> 00:01:26.420
the lock file is actually
outside of it in the top level.

23
00:01:26.420 --> 00:01:29.620
So, by default Gatsby won't use yarn.

24
00:01:29.620 --> 00:01:33.930
So I'm going to tell it to use yarn by
setting an environment variable here.

25
00:01:33.930 --> 00:01:38.060
And this is one way that you can
set an environment variable, but

26
00:01:38.060 --> 00:01:42.725
as you can see, this is a little bit,
I don't know this doesn't scale,

27
00:01:42.725 --> 00:01:46.470
right like having to having
to put a ton of these in.

28
00:01:46.470 --> 00:01:48.610
That's not gonna that's not
gonna fly forever right?

29
00:01:48.610 --> 00:01:50.380
So for one, okay, fine.

30
00:01:50.380 --> 00:01:51.550
All good, don't care.

31
00:01:51.550 --> 00:01:55.430
But for
multiple it's not gonna work very well.

32
00:01:56.450 --> 00:02:00.276
The other thing that we're doing is we're
using these client only routes where we

33
00:02:00.276 --> 00:02:01.760
want these catch alls.

34
00:02:01.760 --> 00:02:05.070
And that means that there
are redirects being done.

35
00:02:05.070 --> 00:02:09.500
And in order to get redirects to get
picked up properly, we need to install

36
00:02:09.500 --> 00:02:14.080
a plugin that will sync those between
Gatsby and whatever host it's using.

37
00:02:14.080 --> 00:02:18.143
So for netlify,
we will yarn workspace site add, and

38
00:02:18.143 --> 00:02:22.420
then we're going to add
Gatsby plugin netlify.

39
00:02:22.420 --> 00:02:26.108
And this is going to make the redirects
work and it adds some other stuff

40
00:02:26.108 --> 00:02:29.310
like Content Security Policy headers and
iframe security.

41
00:02:29.310 --> 00:02:32.620
And some things that will help
with your your web speed score.

42
00:02:34.470 --> 00:02:35.874
Once we've got that plugin,

43
00:02:35.874 --> 00:02:38.630
we can just toss it at
the bottom of our Gatsby config.

44
00:02:38.630 --> 00:02:40.580
Doesn't need any options or anything.

45
00:02:40.580 --> 00:02:48.756
So we'll put in gatsby-plugin-netlify,
okay?

46
00:02:48.756 --> 00:02:53.580
And then, we can just add all this stuff.

47
00:02:53.580 --> 00:02:55.036
So let's add everything.

48
00:02:55.036 --> 00:03:01.381
Git commit and say, site ready to deploy.

49
00:03:04.130 --> 00:03:07.680
Let's push it Okay.

50
00:03:07.680 --> 00:03:12.210
So, what I'm gonna do,
is I have to use this progress branch,

51
00:03:12.210 --> 00:03:16.311
which means I have to do
an extra step because by default,

52
00:03:16.311 --> 00:03:20.080
what netlify will do is,
is run off the main branch.

53
00:03:20.080 --> 00:03:22.270
So I'm gonna do a netlify in it.

54
00:03:22.270 --> 00:03:25.198
And actually, I wonder if it'll let me
set the branch, that would be cool.

55
00:03:28.117 --> 00:03:29.060
Nah, that's okay.

56
00:03:30.290 --> 00:03:32.736
So let's do netlifying it, and

57
00:03:32.736 --> 00:03:36.820
this is going to walk me
through setting up a new site.

58
00:03:36.820 --> 00:03:38.539
So I'm gonna create and
configure a new site.

59
00:03:40.280 --> 00:03:42.220
And then I'm gonna choose my own team.

60
00:03:42.220 --> 00:03:45.010
And I want to give this a name.

61
00:03:45.010 --> 00:03:51.850
So let's call it front end
masters intermediate Gatsby.

62
00:03:54.420 --> 00:03:55.210
That's already taken.

63
00:03:55.210 --> 00:03:57.017
Let's try another one

64
00:03:57.017 --> 00:04:01.779
frontend-masters-intermediate-gatsby-proj-
ect.

65
00:04:03.720 --> 00:04:05.000
There we go.
All right.

66
00:04:05.000 --> 00:04:08.966
So we already know that we've got the base
set to site and because it's reading our

67
00:04:08.966 --> 00:04:13.165
netlify.tom, we'll now it can see it
wants yarn workspace I build, good.

68
00:04:13.165 --> 00:04:15.225
It's pulling public, right?

69
00:04:15.225 --> 00:04:16.995
We can ignore that one.

70
00:04:16.995 --> 00:04:18.865
It needs the essential Gatsby plugin.

71
00:04:18.865 --> 00:04:20.595
This is gonna keep the cache around.

72
00:04:20.595 --> 00:04:22.577
It's gonna make Gatsby functions work.

73
00:04:22.577 --> 00:04:24.958
It does a bunch of stuff like that,
theoretically, you could opt out of it,

74
00:04:24.958 --> 00:04:26.357
but I don't know why you would.

75
00:04:26.357 --> 00:04:28.827
So we will let that run.

76
00:04:28.827 --> 00:04:31.687
And then we're off to the races.

77
00:04:31.687 --> 00:04:33.707
So let's open this.

78
00:04:33.707 --> 00:04:38.280
And what I have to do is because I
see it open in the wrong browser,

79
00:04:38.280 --> 00:04:41.367
let's pull it on to this one.

80
00:04:41.367 --> 00:04:46.216
Because I changed my branch, I'm just
gonna jump into the site settings and

81
00:04:46.216 --> 00:04:47.137
go to deploy.

82
00:04:47.137 --> 00:04:49.649
Let me make this a little bit bigger so
it's easier to read and

83
00:04:49.649 --> 00:04:50.740
to go to build and deploy.

84
00:04:50.740 --> 00:04:53.290
And then I'm going to change the branch.

85
00:04:53.290 --> 00:04:55.820
And I'm just going to build this
progress branch that we've been using.

86
00:04:55.820 --> 00:04:56.760
So let me save that.

87
00:04:58.020 --> 00:04:59.600
head out to my deploys.

88
00:05:01.130 --> 00:05:03.080
You don't need to finish that one so
we can cancel it.

89
00:05:04.330 --> 00:05:07.100
And then I'm going to go to here,
and let's just start again.

90
00:05:07.100 --> 00:05:08.180
So I'm going to deploy the site.

91
00:05:09.580 --> 00:05:10.350
All right.
So here we go.

92
00:05:10.350 --> 00:05:15.780
We're deploying the site, and
this is going to install node.

93
00:05:15.780 --> 00:05:18.870
It's going to install all of our packages.

94
00:05:18.870 --> 00:05:20.477
Yarn, all the things that we need, and

95
00:05:20.477 --> 00:05:22.680
then it's going to run our
yarn workspaces command.

96
00:05:22.680 --> 00:05:26.383
It'll also compile our functions and
store the cache and

97
00:05:26.383 --> 00:05:30.086
all the stuff that we don't
want to have to do ourselves,

98
00:05:30.086 --> 00:05:34.097
so that we can just move on with
our day and be happy about having

99
00:05:34.097 --> 00:05:38.831
deployed a site instead of thinking
about how to get that site deployed.

100
00:05:47.030 --> 00:05:50.402
This'll take usually about two
minutes the first time around, and

101
00:05:50.402 --> 00:05:53.312
then it'll drop down to about
a minute on repeat deploys.

102
00:06:00.837 --> 00:06:06.190
The thing about Gatsby is that
it's a really large NPM package.

103
00:06:06.190 --> 00:06:11.140
But we don't ship most of that to
production, right, Gatsby is a build tool.

104
00:06:11.140 --> 00:06:15.270
So it pulls in a ton of stuff for
building sites.

105
00:06:15.270 --> 00:06:18.843
And then the vast majority of
that is only used for the bill,

106
00:06:18.843 --> 00:06:23.600
it doesn't actually get used in
production on the client site.

107
00:06:23.600 --> 00:06:27.938
So there's a, it's important to look at
not just the package size because that

108
00:06:27.938 --> 00:06:29.380
can be misleading.

109
00:06:29.380 --> 00:06:32.680
It's important to look at what actually
comes out of the production build.

110
00:06:33.930 --> 00:06:39.210
Because a very small package
can produce huge bundle sizes.

111
00:06:39.210 --> 00:06:44.016
If it's not optimized, and
vice versa huge package that's optimized

112
00:06:44.016 --> 00:06:47.150
well can can create some
pretty tiny bundles.

113
00:06:48.660 --> 00:06:50.120
Okay, so we're running the build.

114
00:06:50.120 --> 00:06:52.120
You can see it's installing
this this plug in.

115
00:06:52.120 --> 00:06:54.843
It doesn't have a Gatsby cache
because this is the first time we're

116
00:06:54.843 --> 00:06:56.090
building the site.

117
00:06:56.090 --> 00:06:57.990
It's running that yarn
workspace site build.

118
00:06:57.990 --> 00:06:59.400
That's what we wanted.

119
00:06:59.400 --> 00:07:07.310
So off to the races we go and
this will just take a few more seconds.

120
00:07:07.310 --> 00:07:11.630
And then once this finishes
netlify will bundle the functions,

121
00:07:11.630 --> 00:07:15.310
push all these pages up to this and
then we will be live.

122
00:07:17.850 --> 00:07:18.880
There we go.

123
00:07:18.880 --> 00:07:23.332
Functions bundling that's done,
it's deploying the site,

124
00:07:23.332 --> 00:07:27.790
that goes and we got ourselves a site,
so we can go look at this.

125
00:07:27.790 --> 00:07:31.059
Now we've got our site,
up on the internet,

126
00:07:31.059 --> 00:07:34.510
we can go to our books,
we can go to our account.

127
00:07:35.900 --> 00:07:41.510
And here we go if we log in great,
log out great.

128
00:07:41.510 --> 00:07:42.950
All the things that we want to do, right?

129
00:07:42.950 --> 00:07:44.330
It's all doing what we want.

130
00:07:44.330 --> 00:07:47.210
And we've got our optimized images.

131
00:07:47.210 --> 00:07:49.240
So, this is pretty slick.

132
00:07:49.240 --> 00:07:52.490
It's it's really doing what we
can It's doing what we want.

133
00:07:52.490 --> 00:07:54.170
I'm you know, I'm happy with this.

134
00:07:54.170 --> 00:07:55.850
We're able to get it up pretty quickly.

135
00:07:55.850 --> 00:07:59.840
And it's it's fairly painless
to get this up and running.

136
00:07:59.840 --> 00:08:03.100
And now, any changes that we make
also automatically build and deploy

