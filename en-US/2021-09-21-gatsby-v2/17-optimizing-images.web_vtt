WEBVTT

1
00:00:00.840 --> 00:00:03.540
MDX is is something
that's really powerful.

2
00:00:03.540 --> 00:00:07.380
But there's something that
we haven't talked about yet,

3
00:00:07.380 --> 00:00:12.970
which is probably the biggest factor in
a lot of websites, and that is images.

4
00:00:12.970 --> 00:00:18.410
The management of images can be an
extraordinarily frustrating thing to do.

5
00:00:18.410 --> 00:00:21.727
And I've noticed that on
a lot of modern websites,

6
00:00:21.727 --> 00:00:24.710
people have chosen to
just not deal with it.

7
00:00:24.710 --> 00:00:30.817
So if you go to a lot of websites and
you look at the network tab,

8
00:00:30.817 --> 00:00:35.057
you'll load tens of megabytes of images.

9
00:00:35.057 --> 00:00:39.447
And it just really can
bog down the experience,

10
00:00:39.447 --> 00:00:43.302
it can lead to like
a lot of jumpy content.

11
00:00:43.302 --> 00:00:46.194
Like there's nothing more annoying
than when you go to a page and

12
00:00:46.194 --> 00:00:49.678
you get loaded and then the content that
you're reading jumps down the screen

13
00:00:49.678 --> 00:00:51.192
because an image just popped in.

14
00:00:51.192 --> 00:00:56.325
And these are all experiences that
are solvable, but they're tricky and

15
00:00:56.325 --> 00:01:01.630
they require some custom code and
they require some consideration.

16
00:01:01.630 --> 00:01:06.818
And a lot of times when we're on deadline,
we gotta get something out the door,

17
00:01:06.818 --> 00:01:12.015
we just don't have the time or don't make
the time to deal with those problems.

18
00:01:12.015 --> 00:01:17.114
And that's a real bummer because I
think that a poor image handling

19
00:01:17.114 --> 00:01:22.305
experience from a website is probably
one of the most noticeably bad

20
00:01:22.305 --> 00:01:27.780
things that I deal with on my day
to day Internet browsing activity.

21
00:01:27.780 --> 00:01:32.299
The thing that will get me to close a
website faster than anything else is if I

22
00:01:32.299 --> 00:01:37.540
open a site and everything starts jumping
around because the images don't load well,

23
00:01:37.540 --> 00:01:40.590
there's ads popping in all over the place.

24
00:01:40.590 --> 00:01:44.871
Like if that content feels junky,
it doesn't feel polished,

25
00:01:44.871 --> 00:01:47.390
I'm just like, you know what?

26
00:01:47.390 --> 00:01:49.769
I don't really need to read
whatever this article is,

27
00:01:49.769 --> 00:01:51.338
I'm gonna just do something else.

28
00:01:51.338 --> 00:01:56.151
So what I originally
started using Gatsby for,

29
00:01:56.151 --> 00:01:59.850
honestly, was image management.

30
00:01:59.850 --> 00:02:05.972
Gatsby has a very, or
at least when they first introduced it,

31
00:02:05.972 --> 00:02:11.390
a very novel approach to
managing images in that Gatsby

32
00:02:11.390 --> 00:02:16.454
itself as part of the build
system will optimize and

33
00:02:16.454 --> 00:02:19.661
make responsive and handle UX.

34
00:02:19.661 --> 00:02:23.231
All sorts of improvements around
the way that images work on your site.

35
00:02:23.231 --> 00:02:25.482
And it's built into the framework so

36
00:02:25.482 --> 00:02:29.764
that we as web developers are not here
trying to remember or make time or

37
00:02:29.764 --> 00:02:35.210
convince somebody on the team that we
need to carve out a sprint to fix images.

38
00:02:35.210 --> 00:02:40.168
Instead, we can as part of building our
site, use Gatsby's image plug in, and

39
00:02:40.168 --> 00:02:45.770
the image stuff just happens, it's just
done and we don't have to think about it.

40
00:02:45.770 --> 00:02:49.442
Now, there are still things that you wanna
think about which I've touched on a little

41
00:02:49.442 --> 00:02:51.788
bit when we were talking
about Gatsby build times, and

42
00:02:51.788 --> 00:02:55.310
I'll talk about it a little bit more
as we get further into the section.

43
00:02:55.310 --> 00:03:00.716
But in general, a huge number of problems
with images that lead to a poor UX, slow

44
00:03:00.716 --> 00:03:07.280
load times, bad SEO ranking, because your
site's not fast enough, etc, etc, etc.

45
00:03:07.280 --> 00:03:10.484
All of that stuff can be greatly improved,

46
00:03:10.484 --> 00:03:15.360
with almost no work by using
this Gatsby image plugin.

47
00:03:15.360 --> 00:03:19.130
So to do that, let's go ahead and install
it and take a look at how it works.

48
00:03:19.130 --> 00:03:21.882
So we're gonna install
gatsby-plugin-image.

49
00:03:24.597 --> 00:03:28.510
We're going to install
gatsby-plugin-sharp.

50
00:03:30.370 --> 00:03:36.200
And sharp is an open source library
that does image conversion.

51
00:03:36.200 --> 00:03:41.573
So if you use sharp you can take a JPG and
turn it into a WEBP,

52
00:03:41.573 --> 00:03:46.509
or take a PNG and turn it into,
well, you'd probably

53
00:03:46.509 --> 00:03:51.580
turn it into a WEBP or
an avatar or something like that.

54
00:03:51.580 --> 00:03:53.140
It's a really powerful library.

55
00:03:53.140 --> 00:03:58.304
It's originally built in C and
ported into or I guess wrapped in Node,

56
00:03:58.304 --> 00:04:03.207
which historically has been if
you've ever seen me complain about

57
00:04:03.207 --> 00:04:08.038
sharp it's because sharp doesn't
always build consistently.

58
00:04:08.038 --> 00:04:12.170
So the tool itself is wonderful, the port
of it to note is sometimes frustrating.

59
00:04:12.170 --> 00:04:14.880
But I haven't seen those
problems in a while so

60
00:04:14.880 --> 00:04:18.540
I imagine it's probably
improved quite a bit.

61
00:04:18.540 --> 00:04:21.869
And then we've got
the gatsby-transformer-sharp.

62
00:04:21.869 --> 00:04:24.050
And so
there are two things that happen there.

63
00:04:24.050 --> 00:04:28.188
Well, let's see there are three
main buckets of plugins and

64
00:04:28.188 --> 00:04:33.313
then there's a lot of kind of auxilary
use special case plugins in Gatsby.

65
00:04:33.313 --> 00:04:39.645
There are standard plugins which are like
the image plugin or like the MDX plugin,

66
00:04:39.645 --> 00:04:46.820
where you're basically saying I want to
add this piece of functionality to Gatsby.

67
00:04:46.820 --> 00:04:51.050
There are source plugins like
the filesystem source plugin,

68
00:04:51.050 --> 00:04:55.620
which say, I want you to pull in
a certain type of data into Gatsby.

69
00:04:55.620 --> 00:04:57.648
And then there are transformer plugins.

70
00:04:57.648 --> 00:05:00.598
And transformer plugins
are the ones that will say,

71
00:05:00.598 --> 00:05:05.480
okay, I found a type of data, I wanna
transform it into another type of data.

72
00:05:05.480 --> 00:05:10.881
So transformer sharp will say I'm
looking for files that are images and

73
00:05:10.881 --> 00:05:15.330
I will transform those into
Gatsby optimized images.

74
00:05:15.330 --> 00:05:17.931
So, you'll see those
kind of categories and

75
00:05:17.931 --> 00:05:20.880
that's typically what each one is doing.

76
00:05:20.880 --> 00:05:22.860
So that's why we need
a gatsby-plugin-sharp and

77
00:05:22.860 --> 00:05:25.070
a gatsby-transformer-sharp.

78
00:05:25.070 --> 00:05:27.130
So let's get those installed.

79
00:05:27.130 --> 00:05:32.180
Once we've got that in, we can head on
down to the bottom of our Gatsby config.

80
00:05:32.180 --> 00:05:33.900
And let's add some image setting.

81
00:05:33.900 --> 00:05:41.150
So I want to include another instance
of gatsby-source-filesystem.

82
00:05:43.180 --> 00:05:44.800
And this one is gonna be for images.

83
00:05:44.800 --> 00:05:50.393
So we are going to say it's
got a name of images and

84
00:05:50.393 --> 00:05:54.085
we want to run a path of dirname.

85
00:05:54.085 --> 00:05:57.105
And then remember way at the beginning,
when we were looking at this folder called

86
00:05:57.105 --> 00:05:59.539
images in the source directory,
we're finally gonna use that.

87
00:05:59.539 --> 00:06:01.726
So it's gonna be /src/images.

88
00:06:04.650 --> 00:06:10.747
And then We wanna include
gatsby-plugin-image,

89
00:06:10.747 --> 00:06:14.770
gatsby-plugin-sharp, oops.

90
00:06:18.513 --> 00:06:24.192
And get gatsby-transformer-sharp.

91
00:06:24.192 --> 00:06:27.653
Okay, so now that we've got those,

92
00:06:27.653 --> 00:06:32.687
let's restart our Gatsby server,
npm run develop.

93
00:06:41.667 --> 00:06:42.280
What did I break?

94
00:06:43.320 --> 00:06:48.387
I type out image, image.

95
00:06:51.910 --> 00:06:52.834
Try that one more time.

96
00:06:57.193 --> 00:06:58.149
Here we go.

97
00:07:02.340 --> 00:07:06.016
Okay, so everything is building.

98
00:07:06.016 --> 00:07:15.920
And, Once this finishes, there we go.

99
00:07:15.920 --> 00:07:19.070
Let's head over here and
let's look at what we're getting.

100
00:07:19.070 --> 00:07:24.032
So I'm gonna start with all file and
I'm gonna filter by

101
00:07:24.032 --> 00:07:29.324
the source instance name, and
let's get just the images.

102
00:07:31.770 --> 00:07:34.862
And I want to get nodes and let's get the.

103
00:07:37.037 --> 00:07:41.029
Yeah, I don't know,
let's get the public URL, right?

104
00:07:41.029 --> 00:07:45.522
So this is a trick if you're trying
to like pull in all of your images,

105
00:07:45.522 --> 00:07:49.850
you can filter by whatever
the source instance name is.

106
00:07:49.850 --> 00:07:54.588
In this case, that is what you have
set here, the source instance and

107
00:07:54.588 --> 00:07:56.670
we set a name of images.

108
00:07:56.670 --> 00:07:59.800
So I'm pulling in all of the images,
and we're just getting the public URL.

109
00:07:59.800 --> 00:08:04.490
So if we build the Gatsby site,
the images will be moved over,

110
00:08:09.463 --> 00:08:15.308
To this public URL /static and then
a hash, and then the name of the file.

111
00:08:15.308 --> 00:08:18.180
And this is a kind of nice feature if
you wanna quickly see what's going on.

112
00:08:18.180 --> 00:08:22.939
Now, these images are pretty big so the
previews don't show particularly well, but

113
00:08:22.939 --> 00:08:27.035
you can at least if you know what your
images look like quickly get a sense of

114
00:08:27.035 --> 00:08:32.292
which one you're looking at, except for
this one that apparently doesn't.

115
00:08:32.292 --> 00:08:34.565
I know why that one looks like that,
it's because that's a wall.

116
00:08:34.565 --> 00:08:41.494
[LAUGH] So then in here so we've got
these regular old files, but like,

117
00:08:41.494 --> 00:08:46.673
if we pull in the size these
are pretty well resized.

118
00:08:46.673 --> 00:08:49.206
I run these through squoosh.app,

119
00:08:49.206 --> 00:08:53.940
which if you haven't used squoosh.app,
it is a wonderful tool.

120
00:08:55.610 --> 00:09:02.020
Do I have an image I can Probably do,
here's an image.

121
00:09:02.020 --> 00:09:08.416
So this is a rubber duck that I
made that I'm very happy about.

122
00:09:08.416 --> 00:09:13.236
But if I wanna resize this, I can see,
like I dropped this in, and

123
00:09:13.236 --> 00:09:17.940
we're compressing it and
we get a 92% file size reduction.

124
00:09:17.940 --> 00:09:23.679
So it's down from 376
kilobytes to 31.1 kilobyte.

125
00:09:23.679 --> 00:09:28.128
And you can kind of slide over to see
what the difference in quality is.

126
00:09:28.128 --> 00:09:32.500
And it's there but it's subtle,
you can't see too much of a difference.

127
00:09:32.500 --> 00:09:35.044
Now if I were to like take
the quality way down,

128
00:09:35.044 --> 00:09:37.335
you can kind of see what happens, right?

129
00:09:37.335 --> 00:09:39.220
Like it gets pretty gross.

130
00:09:41.170 --> 00:09:45.102
But we can play with it until
it looks good enough and

131
00:09:45.102 --> 00:09:48.493
you get a huge reduction
in file size there.

132
00:09:48.493 --> 00:09:49.401
So anyways,

133
00:09:49.401 --> 00:09:55.390
I ran these images through through Squoosh
to give us a pretty good starting point.

134
00:09:55.390 --> 00:09:56.632
And there's a reason I did that.

135
00:09:56.632 --> 00:10:01.516
Because even though Gatsby is going to
aActually process these images for us,

136
00:10:01.516 --> 00:10:06.178
part of the build process means it still
has to load the original images into

137
00:10:06.178 --> 00:10:07.170
memory.

138
00:10:07.170 --> 00:10:10.614
So if I use the original
size of these images,

139
00:10:10.614 --> 00:10:15.974
like let's go to Unsplash and
look at the original size of this image.

140
00:10:15.974 --> 00:10:16.989
Here, that's the image.

141
00:10:16.989 --> 00:10:22.810
So if we look at the original image we
can see let's open this in a new tab.

142
00:10:23.810 --> 00:10:27.210
And we'll look at the network tab here.

143
00:10:28.490 --> 00:10:34.950
And if I'm looking at my network tab,
disable the cache, we reload.

144
00:10:34.950 --> 00:10:39.840
This is 3.2 megabytes.

145
00:10:39.840 --> 00:10:41.808
So this is a huge file.

146
00:10:41.808 --> 00:10:48.650
And if I want to process this, I pull it
in, I load 3.2 megabytes into memory.

147
00:10:48.650 --> 00:10:50.610
I have to cut it up into different sizes.

148
00:10:50.610 --> 00:10:53.913
We'll look at what that looks like in
a minute, and do all this work, right?

149
00:10:53.913 --> 00:10:55.311
And that's a huge source
file to start with.

150
00:10:55.311 --> 00:10:59.888
So I'm basically from the get go
setting Gatsby up to fail because I'm

151
00:10:59.888 --> 00:11:01.810
saying here's a huge file.

152
00:11:01.810 --> 00:11:06.160
You don't need 90% of this,
do a bunch of extra work for no reason.

153
00:11:06.160 --> 00:11:09.794
And then I go up to a dozen or
100 or 1,000 pages, and

154
00:11:09.794 --> 00:11:12.910
each one of them has a giant
image on it like this.

155
00:11:12.910 --> 00:11:16.128
And then I'm gonna get mad at
Gatsby because Gatsby's slow.

156
00:11:16.128 --> 00:11:22.140
Optimize your images a little bit like
the way that I would do this is so

157
00:11:22.140 --> 00:11:28.164
we take this image we're gonna save it,
maybe we're gonna save it.

158
00:11:28.164 --> 00:11:32.860
Yeah, we'll save it here and
then I would go over to Squoosh.

159
00:11:34.710 --> 00:11:35.720
And I've got my image.

160
00:11:35.720 --> 00:11:38.551
I drag this one in here, right?

161
00:11:38.551 --> 00:11:44.410
So now we've got this giant image and
I'll just hit this resize button.

162
00:11:44.410 --> 00:11:47.602
Now I happen to know that I'm never
gonna put anything on my site over

163
00:11:47.602 --> 00:11:48.836
1,600 pixels wide.

164
00:11:48.836 --> 00:11:54.048
So I can then make a call,
let's resize this down to 1,600 pixels.

165
00:11:54.048 --> 00:11:59.430
And I can do 75% quality like
that still looks pretty good.

166
00:11:59.430 --> 00:12:01.300
I can barely tell the difference, right?

167
00:12:01.300 --> 00:12:07.660
And I've made a difference from
2.38 megabytes to 152 Kilobytes.

168
00:12:07.660 --> 00:12:09.685
This is a enormous difference,

169
00:12:09.685 --> 00:12:14.641
especially when you start looking at like
a site with hundreds of images on it.

170
00:12:14.641 --> 00:12:16.830
So this is a little bit of upfront work.

171
00:12:16.830 --> 00:12:19.440
You can automate this,
there are tools that will let you do it.

172
00:12:19.440 --> 00:12:20.591
But ultimately,

173
00:12:20.591 --> 00:12:25.045
just make sure people aren't dumping
raw images from their camera or

174
00:12:25.045 --> 00:12:29.975
like your your phone will take a photo and
that photo is like five megabytes.

175
00:12:29.975 --> 00:12:34.206
Don't just dump that straight into
a Gatsby site, make it the smallest or

176
00:12:34.206 --> 00:12:38.371
the the largest size you'll actually
use and optimize it beforehand and

177
00:12:38.371 --> 00:12:41.937
you're gonna really save yourself
some build time that way.

178
00:12:41.937 --> 00:12:46.960
Okay, so diatribe aside, let's get
back into actually using these here.

179
00:12:46.960 --> 00:12:53.270
So we have our list of images, and
these are the unoptimized ones.

180
00:12:53.270 --> 00:12:57.100
So this is the full size image
of 109 kilobytes or this one.

181
00:12:57.100 --> 00:13:01.586
Yeah, so this one is 109 kilobytes and
if I come out here and

182
00:13:01.586 --> 00:13:04.711
load it, there it is, here's the image.

183
00:13:04.711 --> 00:13:07.575
Now I don't need that full size image.

184
00:13:07.575 --> 00:13:09.815
So I'm gonna get my file.

185
00:13:09.815 --> 00:13:11.622
We'll get the nodes, right?

186
00:13:11.622 --> 00:13:14.480
And then under here we
get a child image sharp.

187
00:13:14.480 --> 00:13:19.280
And that child image sharp is gonna let
us get what's called Gatsby image data.

188
00:13:19.280 --> 00:13:23.840
Now, if I query this,
you'll notice that I should've

189
00:13:23.840 --> 00:13:28.408
filtered this down to be just
the source instance name.

190
00:13:33.107 --> 00:13:37.966
So now just our images, we get a type
of layout, we get a background color,

191
00:13:37.966 --> 00:13:39.680
we get the actual images.

192
00:13:39.680 --> 00:13:40.840
So there's a fallback image.

193
00:13:41.960 --> 00:13:43.570
And then we get a source set.

194
00:13:43.570 --> 00:13:46.270
And then we get different sources for
different sizes.

195
00:13:46.270 --> 00:13:51.960
So like here's an image WEBP and
it gets resized down to like 512.

196
00:13:51.960 --> 00:13:56.738
So this is actually really cool
because what this means is now

197
00:13:56.738 --> 00:14:01.149
instead of these huge images,
I can go to this one here.

198
00:14:03.554 --> 00:14:09.920
And this is a resize or that's the logo,
let's look at a different one.

199
00:14:09.920 --> 00:14:13.080
So here is the the smashburger.

200
00:14:14.120 --> 00:14:15.790
Yeah, so here's the smashburger.

201
00:14:15.790 --> 00:14:18.910
This is the original and
let's grab one of the smaller ones.

202
00:14:20.000 --> 00:14:23.250
So this is a resized version
of that smashburger.

203
00:14:23.250 --> 00:14:27.219
And you can see that Gatsby
basically took each of these and

204
00:14:27.219 --> 00:14:29.331
made multiple versions of it.

205
00:14:29.331 --> 00:14:33.964
So that when we do responsive
images if I'm on a phone,

206
00:14:33.964 --> 00:14:38.901
I don't need a 1200 pixel
wide version of this image,

207
00:14:38.901 --> 00:14:43.405
all I need is the 300 pixel wide version.

208
00:14:43.405 --> 00:14:47.037
And if I'm on a modern browser and
I can support WEBP,

209
00:14:47.037 --> 00:14:50.480
I don't need a JPEG, I can use the WEBP.

210
00:14:50.480 --> 00:14:53.560
And so let's actually look at how
big the difference is on these two.

211
00:14:53.560 --> 00:15:00.070
So this is a JPEG,
the JPEG is 88.4 kilobytes at full size.

212
00:15:00.070 --> 00:15:04.703
So let's do the same thing,
same size but with a WEBP.

213
00:15:04.703 --> 00:15:08.650
The WEBP is 60% of the size,
65% of the size.

214
00:15:10.040 --> 00:15:14.050
That's a pretty notable difference for
an image that more or less looks the same.

215
00:15:14.050 --> 00:15:18.400
Like there's barely any change
in the quality of this.

216
00:15:18.400 --> 00:15:20.540
And there's a huge
change in the file size.

217
00:15:20.540 --> 00:15:24.410
So, if your browser supports WEBP, it
definitely makes sense to use that, right?

218
00:15:24.410 --> 00:15:29.888
And so Gatsby is giving us the ability
to do that by providing not just JPEGs,

219
00:15:29.888 --> 00:15:31.609
but also the web piece.

220
00:15:31.609 --> 00:15:36.024
And it's doing that in a way that
can be used with the store set

221
00:15:36.024 --> 00:15:38.635
attribute on images and pictures.

222
00:15:38.635 --> 00:15:41.142
Which means that browsers will just

223
00:15:41.142 --> 00:15:45.390
naturally choose the smallest
size that fits its specs.

224
00:15:45.390 --> 00:15:50.140
So if I'm on a huge browser,
it's gonna use the biggest possible image.

225
00:15:50.140 --> 00:15:52.161
If I'm on a teeny tiny little phone,

226
00:15:52.161 --> 00:15:57.120
it's gonna choose the image that actually
fits the resolution of that phone.

227
00:15:57.120 --> 00:16:00.977
This is a really, really powerful
way to deal with these problems so

228
00:16:00.977 --> 00:16:05.000
that we don't have to,
I don't have to go generate all of these.

229
00:16:05.000 --> 00:16:08.083
I just have to make sure that the source
image isn't a monster, right?

230
00:16:08.083 --> 00:16:10.050
And that's why this is such a cool setup.

231
00:16:10.050 --> 00:16:12.890
And honestly, I don't even need to make
sure the source image isn't a monster.

232
00:16:12.890 --> 00:16:16.800
I could just let Gatsby have a nice
slow build and be okay with that.

233
00:16:16.800 --> 00:16:21.750
And sometimes that's fine, it just depends
on what are you trying to optimize for?

234
00:16:21.750 --> 00:16:24.130
Do you wanna never have
to do any manual work?

235
00:16:24.130 --> 00:16:25.700
Great, Gatsby will do it
all you just got to wait.

