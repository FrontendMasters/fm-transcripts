[00:00:00]
>> So let's do a new component in the components folder called post layout.js. In this post layout, let's import everything is react from react. Then we're gonna import link from Gatsby because I wanna add the ability to add a link at the bottom of every post taking you back to the full listing.

[00:00:22]
And then we're going to import our layout. And this is so that we can grab the content of the MDX post and then I want to insert the details from the MDX post into our layout. So the way that this will work is we're gonna export a default function called post layout.

[00:00:44]
And that is gonna get the children, which is just anything inside of it like the layout would. And then, we're gonna do something from Gatsby called page context. So before I do anything else, let's just show what this looks like. So I'm going to, return the layout, and inside the layout we're gonna send the children.

[00:01:10]
But then I also want to just stringify the page context. This is one of my favorite debugging tools. When in doubt, wait gotta wrap this. No that should be fine. What have I done? I'm missing a closing parentheses is why that's unhappy, okay. So one of my favorite debugging tools when I'm trying to figure out what's going on in Gatsby is to just grab whatever comes out and enlist it.

[00:01:41]
So if you wanna see everything actually this is probably even better let's just do everything that's not children. Let's stringify it underneath the post. So now that we've got this, we need to actually configure Gatsby to use it. So down in here where we have the layout, let's just change that over to post layout, and it's gonna tell us it needs to restart.

[00:02:05]
Okay, so that's restarted, and now we get a whole bunch of stuff. So this is what Gatsby's actually passing in to any given page. And because this is markdown, we get a little bit extra, or MDX I mean. So first we get the path. Okay great we knew the path we're happy about that.

[00:02:23]
So in here we've got the location, and that gives us all the things that you would get. This is actually coming out of Reach Router. So it's information about where we are in the state of navigation in our app. Then we get down into some things that we don't really need to worry about.

[00:02:36]
These are Gatsby things like our page resources, where the what the JSON is for the page. So this is if you wanna see how much data is gonna get sent down with your y Gatsby files. This is why it's good to validate that you're not sending a bunch of data you won't actually use.

[00:02:53]
Information about the page like this is what the files will be called, what the web pack hash is, etc. Static query results so we're we're loading remember we're using the header where we've got this query for the title. And then this is the SEO component that's got the query for the site metadata.

[00:03:11]
The URI, and finally down here we've got page context. And so what page context is, is when you create a page in Gatsby, there's all the way at the bottom of the stack where there's a node API that Gatsby uses called create page. And you pass in a path, you pass in a file that you wanna use as the template, and then you can pass in something called context, which is just an object.

[00:03:35]
And whatever you pass in here gets provided in the page context object. And in the case of MDX, whatever you put in the front matter, gets put into the context object when the page gets created through Gatsby. So that means that in our layout, we can access this page context object, and pull out the title and description and date if we wanted to then feed into our SEO component.

[00:03:59]
So let's actually do that here. We'll go into our post layout. And instead of the props, we're gonna get the page context. And we don't need to distructure this anymore. So instead what we're gonna do, is we're going to get out the title and description, from page context front matter.

[00:04:22]
And down here in the layout, we're gonna set the title to be title, and the description to be description. Okay, so having done that, we can add our link back. So let's add a link to and we're gonna do our blog role on the homepage. Then I'm gonna use a left arrow HTML entity so that we can point back and just say back.

[00:04:51]
So what this gives us is now, we actually get the things that we want. There's the post title and if we look in here in our description. If we can find it where to go. Here's our description, and it shows us the actual description we wrote. And if I go back, let's go to the first blog post.

[00:05:14]
We can see the same thing. So here is our description, this is my first MDX blog post, the title is updated to say my first blog. So now that post layout is actually using the front matter data to update the search engine values. So with pretty minimal changes we're able to kinda wrap our layout and just do the little bit of abstraction that we need.

[00:05:36]
So it'll still use our layout and if we in the future wanna add more fields to it like we wanna add the date or we wanna add the Twitter author or something like that, we can do that. We would just need to modify our SEO component and then add the frontmatter fields and just pull them out here.

[00:05:54]
So if we wanted to add a new one we can pull out like the author field. And we could we could use that then.
>> What's the max number of blog posts that Gatsby can handle without tears?
>> [LAUGH], okay so the thing about Gatsby is that it's not about numbers, it's about the amount of work that is being done.

[00:06:17]
So if you take Gatsby, and you feed it a bunch of files that have one word and no metadata and no images, it can handle thousands, tens of thousands potentially hundreds of thousands. But as you start to add in images to be optimized, if you feed it raw images director from your camera and every images is 50 megabytes and has to be resized, it's gonna choke on dozens of pages.

[00:06:47]
It'll take forever to build the site. So it's very much a matter of what are you asking each page to do? And how much work does it have to do to get from the raw material to the end page that you're looking for? A good example is, if I'm pulling data from a third party API, and that API has a rate limit that requires us to only ask for 10 posts per second before it would like block us from from asking for more.

[00:07:16]
And we asked for 1000 posts. We've just guaranteed 100 seconds of data loading, for Gatsby to run. Now that's not Gatsby's fault. That's a limitation of the API. Where Gatsby does struggle, is when you put tons and tons and tons of images in there. It will try to parse all of those.

[00:07:35]
And it's pretty good at caching things so that it doesn't do work more than it needs to. But it will it just a problem that scales not quite linearly, I wouldn't call it a linear scale, but it's a challenge in that, as you are adding more work to the Gatsby build pipeline, some types of things are gonna balloon very quickly.

[00:07:59]
Like very large images it'll slow down fast. Number of text files, it takes a long time for that to start to bottleneck that. Back. So it's a little bit less about like hard numbers and a lot more about the type and amount of work that you're asking Gatsby to do as part of that build process.

[00:08:17]
I know that's a very squishy answer, but unfortunately that's the best thing I [LAUGH] can.
>> Someone commented that you could potentially host the data somewhere and then Gatsby can import the data at build time and with web hooks trigger builds an incremental builds on Gatsby cloud, which rebuilds what's changed.

[00:08:43]
I don't know anything about that, but maybe you do.
>> If you wanna get really clever, here's again where I think if you find yourself working that hard to make Gatsby build maybe don't use Gatsby. [LAUGH] It's one of those things where if you find the vast majority of the work you're doing is getting the tool to cooperate, you're probably using the wrong tool.

[00:09:06]
I think that you can, you could pull the data down and have it in a JSON file that you refresh periodically with web hooks. And you can check whether or not any data changed in a web hook to see whether or not it's time to rebuild the site.

[00:09:22]
And there are ways to do that that like Gatsby version three, introduced incremental builds as part of the open source frameworks. So if you keep around the cache, you will get incremental builds as part of running Gatsby. So later we'll deploy it to natlaphi and we'll I'll show you how we keep the builds or the cache between builds, so that you get incremental builds on whatever platform.

[00:09:44]
If you keep your cache folder it's gonna work. That's not like a Gatsby cloud specific thing. You can do things like, pulling Delta changes from your CNS and and trying to merge all of that in. But, there's a reason that people say that there are two hard problems in computing and that one of them is caching.

[00:10:10]
And I think that, trying to manage your own cache, is going to be not worth it in the long run. You will end up causing yourself problems, you'll do something clever with your cache. It'll go wrong, it'll get out of sync, your site will go down, you'll get paged on a Saturday night.

[00:10:30]
Anytime I've seen somebody build a clever workaround for making Gatsby faster they've ended up regretting it. So instead. Look at what data do we actually need? What data are we querying for that we're not using? Are images being served at 10 megabytes each and Gatsby is having to parse all those down?

[00:10:52]
Are we holding on to the cache folder in between builds? How often are we running Gatsby clean? How often are we deleting the cache? Because each of those things is gonna slow down our build times. A lot of people I've seen have this bad habit of running as part of their build Gatsby clean and and Gatsby build.

[00:11:09]
Please don't do that. You're guaranteeing the slowest possible build. And Gatsby works really hard to make that cache work. So there's a lot of things that if you just look at what you're feeding Gatsby, you can make it fast without having to resort to complicated workarounds. And if you find yourself resorting to complicated workarounds, It may be worth considering a different build tool because ultimately, if the majority of your work is fighting your build tool then you're probably not using the right tool.

[00:11:46]
Yeah that's a little rantier than I intended to be but, I've definitely seen a lot of people cause themselves a lot of pain by digging into this and thinking they can outsmart Gatsby's build system. Trust me, it's way too complicated. You're not gonna outsmart it, you're just gonna break it.

[00:12:03]
If you are getting inconsistently like something's not working. You can do a comparison between the code that's on the progress branch. That's been pushed. Only me make sure it's up to date. Yeah everything that we've done so far is pushed up, so check that you can pull the latest changes to make sure that the code that you've written matches the code that we've been writing.

[00:12:28]
Otherwise yeah, the front matter stuff is kinda built in. There's not a lot if you've got these fence code blocks, there's not a lot that we can do to make that not work. So if it's written like this, it should be getting picked up. Assuming the config in here is the same.

[00:12:47]
How can you access the variables from the MDX file? We're gonna get into that, I will show you in a couple of steps, we'll get some of the props and work with them a little bit. The short version is that you can just access props, the way that you would in a react component inside of MDX, but we'll actually walk through building that in a little bit.

