WEBVTT

1
00:00:00.000 --> 00:00:04.954
So, there's a little bit more game UI that
we need to add before we start making

2
00:00:04.954 --> 00:00:07.819
it look nice and
that is the countdown timer.

3
00:00:07.819 --> 00:00:11.780
You'll recall from when we
were looking at this before,

4
00:00:11.780 --> 00:00:15.087
we have a countdown timer
at the top of the page.

5
00:00:15.087 --> 00:00:19.090
And you can see that the bar
is gradually dwindling.

6
00:00:19.090 --> 00:00:22.635
It just makes the game
a little bit more fun and

7
00:00:22.635 --> 00:00:26.288
challenging if you're
up against the clock.

8
00:00:26.288 --> 00:00:34.969
So, we're gonna create one more component
that's a countdown.svelte component.

9
00:00:34.969 --> 00:00:39.475
And inside there we're

10
00:00:39.475 --> 00:00:44.659
gonna take a remaining prop

11
00:00:50.338 --> 00:00:55.012
And a duration prop that
should be a lowercase number.

12
00:00:55.012 --> 00:00:58.142
We need to add lang equals ts so

13
00:00:58.142 --> 00:01:03.168
that we know that we're
dealing with titrate.

14
00:01:03.168 --> 00:01:07.210
Div of class equals countdown and

15
00:01:07.210 --> 00:01:13.570
then inside the we're gonna
have the pause button.

16
00:01:13.570 --> 00:01:19.837
And the bar representing the duration and
inside that bar,

17
00:01:19.837 --> 00:01:24.359
the bar representing the remaining time.

18
00:01:28.934 --> 00:01:32.226
So the container element is
gonna be another flex element.

19
00:01:40.536 --> 00:01:45.050
The duration bar is gonna fill the
remainder of the space after the button

20
00:01:45.050 --> 00:01:46.086
has been added.

21
00:01:46.086 --> 00:01:54.502
And then the remaining bar is just gonna
be a position absolute bar inside that.

22
00:01:54.502 --> 00:01:59.318
All right,
let's add this component to the page so

23
00:01:59.318 --> 00:02:03.910
that we can start seeing it and
that way we'll get

24
00:02:03.910 --> 00:02:08.618
immediate feedback as we
are writing the styles.

25
00:02:08.618 --> 00:02:13.492
This will helpers figure
out what needs to go where.

26
00:02:13.492 --> 00:02:19.414
So go back to our page and
then inside game.svelte

27
00:02:19.414 --> 00:02:25.481
in that top info container
we'll add the countdown

28
00:02:28.712 --> 00:02:33.876
Remaining well,
let's just do LevelDuration for

29
00:02:33.876 --> 00:02:38.570
now and
then duration is also levelDuration.

30
00:02:46.556 --> 00:02:49.424
And you can see that it's
imported that component and

31
00:02:49.424 --> 00:02:51.410
put it at the top of our script block.

32
00:02:58.562 --> 00:03:03.499
So, the first thing we wanna
do is get a pause icon

33
00:03:03.499 --> 00:03:07.002
that we can put inside our button.

34
00:03:07.002 --> 00:03:11.934
What I usually do is I just
Google material, design icons,

35
00:03:11.934 --> 00:03:17.361
there's a site called pictograms
which I find pretty reliable,

36
00:03:17.361 --> 00:03:19.743
if I'm looking for an icon.

37
00:03:19.743 --> 00:03:23.864
If I go in here and I search for
pause then I'll see this pause

38
00:03:23.864 --> 00:03:27.833
circle icon here that looks
like basically what we want.

39
00:03:27.833 --> 00:03:32.745
So I'm gonna open that then
click on the code symbol here

40
00:03:32.745 --> 00:03:36.098
it's gonna copy a bunch of SVG for me.

41
00:03:36.098 --> 00:03:43.238
And I'm just gonna put that
inside the button like that.

42
00:03:43.238 --> 00:03:48.227
We can't see it yet, because we
need to make the button big enough.

43
00:04:00.093 --> 00:04:04.626
Okay, now we can see
the SVG inside the button.

44
00:04:04.626 --> 00:04:09.837
This duration div needs to have a width
and a height so that we can see it.

45
00:04:09.837 --> 00:04:12.403
I will give that a height of 1M and

46
00:04:12.403 --> 00:04:16.352
a background colour of yellow so
that we can see it.

47
00:04:16.352 --> 00:04:20.395
And you can see that it is now
appearing at the top of the info block.

48
00:04:20.395 --> 00:04:28.181
But we wanna make everything inside
her centre aligned I that and

49
00:04:28.181 --> 00:04:34.681
as is our custom we'll give
it a gap of let's say 1M.

50
00:04:34.681 --> 00:04:39.833
We're gonna make the button have

51
00:04:39.833 --> 00:04:44.621
a square aspect ratio as well.

52
00:04:44.621 --> 00:04:49.272
We're gonna make the contents of

53
00:04:49.272 --> 00:04:53.763
the button fill its container.

54
00:04:59.178 --> 00:05:02.823
Okay, that's starting to
look how we want it to look.

55
00:05:02.823 --> 00:05:08.351
Except that I think we're gonna wanna
give the SVG a different fill color.

56
00:05:08.351 --> 00:05:15.190
I'm gonna make this slightly tidier so
they can see what's going on.

57
00:05:15.190 --> 00:05:22.508
At the end of the path, we don't have a
fill attribute so we're gonna create one.

58
00:05:22.508 --> 00:05:27.450
And for now we'll just put in 999 or
something like that.

59
00:05:27.450 --> 00:05:32.858
At this point I think we can get rid
of the purple background on the info

60
00:05:32.858 --> 00:05:38.748
boxes because we don't need that anymore,
we can see what's happening.

61
00:05:38.748 --> 00:05:41.455
Just gonna get rid of that and I'm gonna
do the same for the grid container.

62
00:05:41.455 --> 00:05:44.817
We don't need that anymore.

63
00:05:44.817 --> 00:05:47.115
I think starting to look
a little bit nicer.

64
00:05:48.724 --> 00:05:53.885
Back over in countdown.svelte we'll give

65
00:05:53.885 --> 00:06:00.582
the duration a background of let's say,
999 again.

66
00:06:00.582 --> 00:06:03.251
Actually, no a little lighter, CCC.

67
00:06:03.251 --> 00:06:09.579
And then the remaining can
have a height of 100%.

68
00:06:09.579 --> 00:06:14.513
And a background that's gonna be a little
bit darker so that we can see it.

69
00:06:14.513 --> 00:06:19.464
Let's do 999.

70
00:06:19.464 --> 00:06:21.180
Right, now it's not visible because
we haven't given it a width.

71
00:06:21.180 --> 00:06:25.048
We're gonna need to
control the width based

72
00:06:25.048 --> 00:06:29.235
on how much time is
remaining in our countdown.

73
00:06:29.235 --> 00:06:34.359
One easy way to do this is to
use a CSS custom property.

74
00:06:34.359 --> 00:06:39.387
So, add style equals and
then do say --p is gonna

75
00:06:39.387 --> 00:06:44.078
be remaining as a proportion
of the duration.

76
00:06:44.078 --> 00:06:49.020
And then we can base the width
on that value to occur count

77
00:06:49.020 --> 00:06:53.870
of 100% times the P
that we just passed in.

78
00:06:53.870 --> 00:06:59.467
Because the remaining is default
to the duration of the level,

79
00:06:59.467 --> 00:07:03.808
it's filling the entire
range that we have got.

80
00:07:03.808 --> 00:07:08.609
So, let's actually make
the countdown work inside

81
00:07:08.609 --> 00:07:13.531
game.svelte we gonna use
request animation frame.

82
00:07:13.531 --> 00:07:16.712
I will create a countdown function.

83
00:07:20.159 --> 00:07:25.195
And inside her we we'll have
some request animation frame

84
00:07:25.195 --> 00:07:31.372
logic that is gonna assign to some
new values that we're gonna create.

85
00:07:31.372 --> 00:07:37.727
So let remaining number is
gonna begin as level.duration.

86
00:07:37.727 --> 00:07:42.199
Let duration is also level.duration?

87
00:07:42.199 --> 00:07:47.211
But when we start the countdown we're

88
00:07:47.211 --> 00:07:53.479
gonna decrement remaining
until it hits zero.

89
00:07:53.479 --> 00:07:59.053
First thing we need to do is find
out what the current time is.

90
00:07:59.053 --> 00:08:01.043
Start equals date dot now.

91
00:08:06.016 --> 00:08:10.723
And then we can store how much time is
remaining at each point once the countdown

92
00:08:10.723 --> 00:08:11.519
activates.

93
00:08:11.519 --> 00:08:16.080
Remaining at start equals remaining.

94
00:08:16.080 --> 00:08:17.903
Then we'll create our
request animation frame loop.

95
00:08:17.903 --> 00:08:21.483
Just call it loop like that and

96
00:08:21.483 --> 00:08:26.064
the first thing we're gonna do is call

97
00:08:26.064 --> 00:08:31.083
itself inside request animation frame.

98
00:08:34.317 --> 00:08:37.222
And we're gonna assign to remaining and

99
00:08:37.222 --> 00:08:42.699
do remaining_at_start minus whatever
time has elapsed since the start.

100
00:08:42.699 --> 00:08:47.142
They might look at that code
that I just wrote and think,

101
00:08:47.142 --> 00:08:51.887
well, why not just subtract
a 60th of a second each time?

102
00:08:51.887 --> 00:08:53.321
It's a valid question.

103
00:08:53.321 --> 00:08:58.300
The reality is that you can't guarantee
that request animation frame is gonna

104
00:08:58.300 --> 00:09:00.800
be called exactly 60 times a second.

105
00:09:00.800 --> 00:09:04.011
So you can get kinda a drift
when you do things that way.

106
00:09:04.011 --> 00:09:08.353
It's better if you can deal with
Delta's from absolute times.

107
00:09:08.353 --> 00:09:11.754
You'll get a more
accurate result that way.

108
00:09:11.754 --> 00:09:16.788
So if remaining is less than zero or
less than or equal to zero I

109
00:09:16.788 --> 00:09:22.042
guess I should well then at that point,
the game has been lost.

110
00:09:22.042 --> 00:09:25.015
So we'll just add a note
to ourselves to do.

111
00:09:25.015 --> 00:09:27.967
The game has been lost and

112
00:09:27.967 --> 00:09:33.034
we wanna stop the countdown at that point.

113
00:09:33.034 --> 00:09:39.915
So let's add another value
we'll do let playing.

114
00:09:39.915 --> 00:09:44.864
Is false and
then inside our loop if the game

115
00:09:44.864 --> 00:09:49.677
is no longer playing then we return before

116
00:09:49.677 --> 00:09:54.232
calling the request animation frame.

117
00:09:54.232 --> 00:09:59.518
And then down here, playing becomes

118
00:09:59.518 --> 00:10:03.787
false once we run out of time.

119
00:10:03.787 --> 00:10:09.762
I'm gonna add an onMount here
that just calls countdown.

120
00:10:09.762 --> 00:10:16.689
And then we are gonna pass that remaining
value into our countdown component.

121
00:10:25.357 --> 00:10:28.503
It's not working because I forgot
to call the loop function.

122
00:10:28.503 --> 00:10:30.315
The S code is hopefully great out so

123
00:10:30.315 --> 00:10:32.952
that I can see that it's
not being used anywhere.

124
00:10:32.952 --> 00:10:35.808
If I now, run now hopefully,

125
00:10:35.808 --> 00:10:41.648
we're gonna start seeing that
countdown bar to the window.

126
00:10:41.648 --> 00:10:43.140
Yes we are, okay.

127
00:10:43.140 --> 00:10:47.551
So things are starting to come together

